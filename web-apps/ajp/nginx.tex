

\section{Nginx reverse proxy}

Compile Nginx source code with the
\href{https://github.com/dvershinin/nginx_ajp_module}{ajp module} and configure it to point
the AJP Port.


\begin{verbatim}
wget https://nginx.org/download/nginx-1.21.3.tar.gz
tar -xzvf nginx-1.21.3.tar.gz
git clone https://github.com/dvershinin/nginx_ajp_module.git
cd nginx-1.21.3
sudo apt install libpcre3-dev
./configure --add-module=`pwd`/../nginx_ajp_module \
    --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx  \
    --modules-path=/usr/lib/nginx/modules
make
sudo make install
nginx -V
\end{verbatim}


Comment out the entire \verb+server+ block and append the following lines
inside the \verb+http+ block in \verb+/etc/nginx/conf/nginx.conf+.

\begin{verbatim}
upstream tomcats {
	server <TARGET_SERVER>:8009;
	keepalive 10;
	}
server {
	listen 80;
	location / {
		ajp_keep_conn on;
		ajp_pass tomcats;
	}
}
\end{verbatim}

Start Nginx and check if everything is working correctly by issuing a cURL
request 
\begin{verbatim}
sudo nginx
curl http://127.0.0.1:80
\end{verbatim}
