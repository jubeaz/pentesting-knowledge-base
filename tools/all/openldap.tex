\section{OpenLDAP}
\label{tool:openldap}


\subsection*{ldapsearch}
\label{tool:ldapsearch}

\begin{verbatim}
ldapsearch -H uri \
    <auth> \
    [-b dn] # base dn for search]
    [-s scope ]
    ["(<filtering>)"]
    ["attr" "attr"]
\end{verbatim}


\subsubsection*{Authentication}

first mechanism of authentication: simple authentication where a distinguish
name and a password is provided


OpenLDAP clients and servers are capable of authenticating via the Simple
Authentication and Security Layer (SASL) framework.

There are several industry standard authentication mechanisms that can be used
with SASL, including GSSAPI for Kerberos V, DIGEST-MD5, and PLAIN and EXTERNAL
for use with Transport Layer Security (TLS).

Some mechanisms, such as PLAIN and LOGIN, offer no greater security over LDAP
simple authentication. Like LDAP simple authentication, such mechanisms should
not be used unless you have adequate security protections in place. It is
recommended that these mechanisms be used only in conjunction with Transport
Layer Security (TLS). Use of PLAIN and LOGIN are not discussed further in this
document.

The DIGEST-MD5 mechanism is the mandatory-to-implement authentication mechanism
for LDAPv3. Though DIGEST-MD5 is not a strong authentication mechanism in
comparison with trusted third party authentication systems (such as Kerberos or
public key systems), it does offer significant protections against a number of
attacks. Unlike the CRAM-MD5 mechanism, it prevents chosen plaintext attacks.
DIGEST-MD5 is favored over the use of plaintext password mechanisms. The
CRAM-MD5 mechanism is deprecated in favor of DIGEST-MD5. Use of DIGEST-MD5 is
discussed below.

The GSSAPI mechanism utilizes Kerberos V to provide secure authentication services.

The EXTERNAL mechanism utilizes authentication services provided by lower level
network services such as TLS (TLS). When used in conjunction with TLS
X.509-based public key technology, EXTERNAL offers strong authentication.

There are other strong authentication mechanisms to choose from, including OTP
(one time passwords) and SRP (secure remote passwords). These mechanisms are
not discussed in this document.

{\bf Simple Authentication}

\begin{verbatim}
ldapsearch -x -D DN_FOR_LOGIN {-W | -w PASSWORD | -y PASSORD_FILE}
ldapsearch -x -D CasGuest@cascade.local {-W | -w PASSWORD | -y PASSORD_FILE}
\end{verbatim}
\subsubsection*{SASL}

{\bf GSSAPI}

\begin{itemize}
    \item \verb+-I+ interactive SASL
    \item \verb+-Q+ quiet never prompt
    \item \verb++
    \item \verb++
\end{itemize}

\begin{verbatim}
kinit -c /tmp/<yourlogin>.cc.tmp <yourlogin>
export KRB5CCNAME=/tmp/<yourlogin>.cc.tmp
ldapsearch -Tx -h <host> -p <port> -Y GSSAPI -b "dc=example,dc=com" cn=*
\end{verbatim}

{\bf DIGEST-MD5}

\begin{verbatim}
ldapsearch -Y DIGEST-MD5 -U u000997 -b dc=example,dc=com 'cn=andrew*
\end{verbatim}

{\bf KERBEROS V4}


\subsubsection*{Options}

\begin{itemize}
    \item \verb+-b+: base search (\verb+-b "DC=XX,DC=YY"+)
    \item \verb+-H+: ldap host uri (\verb+-H ldap://XX+)
    \item \verb+-W+: prompt for password
    \item \verb+-Z[Z]+: Use SSL when communicating with the directory server If
        you use -ZZ, the command will require the operation to be successful.
    \item \verb+-s {base|one|sub|children}+:  Specify the scope of the search
        to be one of base, one, sub, or children to specify a base object,
        one-level, subtree, or children search.  The  default  is sub.  Note:
        children scope requires LDAPv3 subordinate feature extension.
\end{itemize}

\subsubsection*{Output}

\begin{verbatim}
  -L         print responses in LDIFv1 format
  -LL        print responses in LDIF format without comments
  -LLL       print responses in LDIF format without comments
  \end{verbatim}

\subsubsection*{Performance}

\begin{itemize}
    \item \verb+-l timelimit+  wait at most \verb+timelimit+ seconds for a search to complete.
    \item \verb+-z sizelimit+ retrieve at most \verb+sizelimit+ entries for a search.
\end{itemize}

\subsubsection*{Common usages}

{\bf Password policy}
\label{tool:ldapsearch:password-policy}

\begin{verbatim}
$ ldapsearch -H ldap://casc-dc1.cascade.local -x -b "DC=cascade,dc=local"

ldapsearch -H ldap://FQDN -x -b "DC=XX,DC=YY" -s sub "*" \
    | grep -m 1 -B 10 pwdHistoryLength
\end{verbatim}



{\bf User enum}
\label{tool:ldapsearch:user-enum}

\begin{verbatim}
ldapsearch -H ldap://FQDN  -x -b "DC=XXX,DC=YY" -s sub "(&(objectclass=user))" \
    | grep sAMAccountName: | cut -f2 -d" "
\end{verbatim}

Get properties on users:
\begin{verbatim}
$ ldapsearch -H ldap://FQDN  -x -b "DC=cascade,dc=local" \
    -s sub  "(objectclass=user)" | grep : | cut -d ':' -f 1 |sort | uniq
\end{verbatim}

{\bf Computer }


\subsection*{links}
\begin{itemize}
    \item \url{}
\end{itemize}
