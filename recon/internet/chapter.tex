\chapter{Internet presence}


\section{What to look for}
\begin{tabularx}{\linewidth}{|l|X|}
\hline
Data Point &	Description\\
\hline
IP Space &	Valid \gls{ASN}, netblocks in use for the public-facing infrastructure,
cloud presence and the hosting providers, DNS record entries, \ldots\\
\hline
Domain Information & 	Based on IP data, DNS, and site registrations. Who
administers the domain? Are there any subdomains tied ? Are there
any publicly accessible domain services present? (Mailservers, DNS, Websites,
VPN portals, etc.) Can we determine what kind of defenses are in place? (SIEM,
AV, IPS/IDS in use, \ldots)\\
\hline
Schema Format &	Can we discover email accounts, AD
usernames, and even password policies? Anything that will give information that
can be used to build a valid username list to test external-facing services for
password spraying, credential stuffing, brute forcing, \ldots.\\
\hline
Data Disclosures &	looking fublicly accessible files ( .pdf, .ppt, .docx,
.xlsx, \ldots ) for any information that helps shed light on the target. For
example, any published files that contain intranet site listings, user
metadata, shares, or other critical software or hardware in the environment
(credentials pushed to a public GitHub repo, the internal AD username format in
the metadata of a PDF, for example. )\\
\hline
Breach Data &	Any publicly released usernames, passwords, or other critical
information that can help  gain a foothold.\\
\hline
\end{tabularx}

\section{Where looking ?}

\begin{tabularx}{\linewidth}{|l|X|}
\hline
Resource & 	Examples \\
\hline
ASN / IP registrars 	& \href{https://www.iana.org/}{IANA},
\href{https://www.arin.net/}{arin} for searching the Americas,
\href{https://www.ripe.net/}{RIPE} for
searching in Europe, \href{https://bgp.he.net/}{BGP Toolkit} \\
\hline
Domain Registrars \& DNS &
\href{https://www.domaintools.com/}{Domaintools},\href{http://ptrarchive.com/}{PTRArchive},
\href{https://viewdns.info/}{viewdns.info}, 
\href{https://lookup.icann.org/lookup}{ICANN}, manual DNS record
requests against the domain in question or against well known DNS servers, such
as 8.8.8.8.\\
\hline
Social Media &	Searching Linkedin, Twitter, Facebook, your region's major
social media sites, news articles, and any relevant info you can find about the
organization.\\
\hline
Public-Facing Company Websites & 	Often, the public website for a corporation
will have relevant info embedded. News articles, embedded documents, and the
"About Us" and "Contact Us" pages can also be gold mines.\\
\hline
Cloud \& Dev Storage Spaces &	\href{https://github.com/}{GitHub}, \href{https://grayhatwarfare.com/}{AWS S3 buckets \& Azure Blog storage
containers}, \href{https://www.exploit-db.com/google-hacking-database}{Google
searches using "Dorks"}\\
\hline
Breach Data Sources &	\href{https://haveibeenpwned.com/}{HaveIBeenPwned}to determine if any corporate email
accounts appear in public breach data, \href{https://www.dehashed.com/}{Dehashed} to search for corporate emails
with cleartext passwords or hashes we can try to crack offline. We can then try
these passwords against any exposed login portals (Citrix, RDS, OWA, 0365, VPN,
VMware Horizon, custom applications, etc.) that may use AD authentication.\\
\hline
\end{tabularx}

\input{recon/internet/domain}

\section{Finding Address Spaces}
The \href{https://bgp.he.net/}{BGP Toolkiti} is a fantastic resource for
researching from a domain or an IP address what address blocks are assigned to an organization and what ASN
they reside within. 
Many large
corporations will often self-host their infrastructure, and since they have
such a large footprint, they will have their own ASN. This will typically not
be the case for smaller organizations or fledgling companies.


Smaller organizations will often host their websites
and other infrastructure in someone else's space (Cloudflare, Google Cloud,
AWS, or Azure, for example). Understanding where that infrastructure resides is
extremely important. 

\section{DNS}

DNS is a great way to validate our scope and find out about reachable hosts the
customer did not disclose in their scoping document. Sites like domaintools,
and viewdns.info are great spots to start. We can get back many records and
other data ranging from DNS resolution to testing for DNSSEC and if the site is
accessible in more restricted countries. Sometimes we may find additional hosts
out of scope, but look interesting. In that case, we could bring this list to
our client to see if any of them should indeed be included in the scope. We may
also find interesting subdomains that were not listed in the scoping documents,
but reside on in-scope IP addresses and therefore are fair game.

\section{Public Data}

Social media can be a treasure trove of interesting data that can clue us in to
how the organization is structured, what kind of equipment they operate,
potential software and security implementations, their schema, and more. On top
of that list are \textbf{job-related sites} like LinkedIn, Indeed.com, and
Glassdoor. Simple job postings often reveal a lot about a company.

Websites hosted by the organization are also great places to dig for
information (contact emails, phone numbers, organizational charts, published
documents, \ldots). These sites, specifically the embedded documents, can often
have links to internal infrastructure or intranet sites. Checking any publicly
accessible information for those types of details can be quick wins when trying
to formulate a picture of the domain structure. With the growing use of sites
such as GitHub, AWS cloud storage, and other web-hosted platforms, data can
also be leaked unintentionally. For example, a dev working on a project may
accidentally leave some credentials or notes hardcoded into a code release. It
could mean the difference between having to password spray and brute-force
credentials for hours or days or gaining a quick foothold with developer
credentials, which may also have elevated permissions. Tools like
\href{https://github.com/trufflesecurity/truffleHog}{Trufflehog} and sites like
\href{https://buckets.grayhatwarfare.com/}{Greyhat Warfare} are fantastic
resources for finding these breadcrumbs.

\section{Hunting For Files}

\begin{verbatim}
filetype:pdf inurl:prey.com
\end{verbatim}

\section{Hunting E-mail Addresses}

\begin{verbatim}
intext:"@inlanefreight.com" inurl:prey.com
\end{verbatim}

Browsing the contact page

\section{Username Harvesting}

tool such as linkedin2username~\ref{tool:linkedin2username} to scrape data from
a company's LinkedIn page and create various mashups of usernames (flast,
first.last, f.last, etc.) that can be added to the list of potential password
spraying targets.

\section{Credential Hunting}

\href{http://dehashed.com/}{Dehashed} is an excellent tool for hunting for
cleartext credentials and password hashes in breach data. Typically we will
find many old passwords for users that do not work on externally-facing portals
that use AD auth (or internal). This is another tool that can be useful for
creating a user list for external or internal password spraying.

\begin{verbatim}
sudo python3 dehashed.py -q prey.local -p
\end{verbatim}

github\ldots
