\chapter{Tools}

\section{Android Studio}
Android Studio is the official Android development environment based on
IntelliJ IDEA. It provides integrated Android developer tools for development
and debugging. 

\subsection{Installation}
You can install it with the android-studioAUR package.

Android Studio creates a \verb+.android+ directory in home directory. To reset
Android Studio, this directory can be removed.

Note:
    Make sure you properly set the Java environment otherwise android-studio will not start.
    If Android Studio shows up as a blank window try exporting
    \verb+_JAVA_AWT_WM_NONREPARENTING=1+, see
    \href{https://code.google.com/p/android/issues/detail?id=57675}{issue
    \#57675}.

The Android Studio Setup Wizard installs the required SDK packages and places
the SDK by default in \verb+~/Android/Sdk+.

To build apps from the command-line (using e.g. 
\verb+./gradlew assembleDebuga+) set the
\href{https://developer.android.com/studio/command-line/variables#android_home}{ANDROID\_HOME}
environment variable to your SDK location.

\subsection{Emulator}
The Android Emulator is available as the emulator SDK package, the
android-emulatorAUR package, and there is also a dummy package for it:
android-emulator-dummyAUR.

To run the Android Emulator you need an Intel or ARM System Image. You can
install them through the AUR[2], with the sdkmanager or using Android Studio's
AVD Manager.

\url{https://developer.android.com/studio/run/advanced-emulator-usage}
\subsubsection{Send Emulator console commands}

\begin{verbatim}
# emulator window title lists the console port number
telnet localhost console-port
\end{verbatim}

Before you can enter console commands, the emulator console requires
authentication. \verb+auth_token+ must match the contents of the
\verb+.emulator_console_auth_token+ file in your home directory.  If that file
doesn't exist, the telnet localhost console-port command creates the file,
which contains a randomly generated authentication token. 

\begin{verbatim}
$ telnet localhost 5554
.. .
.. .
auth 123456789ABCdefZ
\end{verbatim}

\subsubsection{Networking}
Each instance of the emulator runs behind a virtual router/firewall service
that isolates it from your development machine network interfaces and settings
and from the internet. An emulated device can't see your development machine or
other emulator instances on the network. Instead, it sees only that it is
connected through Ethernet to a router/firewall.

The virtual router for each instance manages the 10.0.2/24 network address
space — all addresses managed by the router are in the form of 10.0.2.xx, where
xx is a number. Addresses within this space are pre-allocated by the
emulator/router as follows:
\begin{verbatim}
Network Address 	Description
10.0.2.1 	Router/gateway address
10.0.2.2 	Special alias to your host loopback interface (i.e., 127.0.0.1 on your development machine)
10.0.2.3 	First DNS server
10.0.2.4 / 10.0.2.5 / 10.0.2.6 	Optional second, third and fourth DNS server (if any)
10.0.2.15 	The emulated device network/ethernet interface
127.0.0.1 	The emulated device loopback interface
\end{verbatim}

Android apps running in an emulator can connect to the network available on
your workstation. However, apps connect through the emulator, not directly to
hardware, and the emulator acts like a normal app on your workstation. This can
cause some limitations:
\begin{itemize}
    \item  Communication with the emulated device may be blocked by a firewall
        program running on your machine.
    \item  Communication with the emulated device may be blocked by another
        (physical) firewall/router to which your machine is connected.
\end{itemize}

The emulator virtual router should be able to handle all outbound TCP and UDP
connections/messages on behalf of the emulated device, provided your
development machine network environment allows it to do so. There are no
built-in limitations on port numbers or ranges except the one imposed by your
host operating system and network.

Depending on the environment, the emulator might not be able to support other
protocols (such as ICMP, used for "ping"). Currently, the emulator does not
support IGMP or multicast.

\section{Genymotion}

is a pay for Android emulation/testing suite.
\subsection{Installation}
after installing the AUR package, reload virtualbox
\begin{verbatim}
$ sudo vboxreload
\end{verbatim}

\section{Android Debug Bridg (adb)}
\begin{verbatim}
sudo apt install android-tools-adb
sudo pacman -S android-tools
\end{verbatim}

\url{https://developer.android.com/studio/command-line/adb}

\url{https://kavigihan.medium.com/hacking-android-devices-with-adb-b5565560bb55}

\url{https://www.xda-developers.com/install-adb-windows-macos-linux/}
\begin{verbatim}
adb devices
adb shell pm list packages|grep route
adb shell dumpsys package com.routerspace
adb shell am start -n com.routerspace/.MainActivity
\end{verbatim}


\section{Anbox}
\url{https://docs.anbox.io/index.html}

\begin{verbatim}
apt-get install lxc
apt-get install anbox
$ ls -1 /dev/{ashmem,binder}
$ sudo modprobe ashmem_linux
$ sudo modprobe binder_linux
wget https://build.anbox.io/android-images/2018/07/19/android_amd64.img
mv android_amd64.img /var/lib/anbox/android.img
systemctl start anbox-container-manager.service

anbox launch --package=org.anbox.appmgr --component=org.anbox.appmgr.AppViewActivity

\end{verbatim}

Switch to the desktop and you’ll find Anbox in the Application menu. Click it to open the application manager:
\begin{verbatim}
adb install RouterSpace.apk
he first time we get an error because the daemon isn’t running. It starts automatically, so just run the command again:
\end{verbatim}

\begin{verbatim}
adb shell settings put global http_proxy <host>:<port>
adb shell settings get global http_proxy
# disable proxy
adb shell settings put global http_proxy :0

db shell settings delete global http_proxy
adb shell settings delete global global_http_proxy_host
adb shell settings delete global global_http_proxy_port
\end{verbatim}
