\section{Software (T1518) and Security Software Discovery (T1518.001)}
\label{T1518.001}
\href{https://wadcoms.github.io/}{WADComs project} is an interactive cheat
sheet for many of the tools needed. It's hugely helpful to get exact command syntax or are trying out a tool for the first time.

After gaining a foothold, this access is used to get a feeling for the defensive state of the hosts, enumerate the domain further, and, if necessary, work at "living off the land" by using tools that exist natively on the hosts.

It is important to understand the security controls in place in an organization as the products in use can affect the tools use for our enumeration, as well as exploitation and post-exploitation. 

Understanding the protections will help inform decisions regarding tool usage
and assist us in planning the course of action by either avoiding or modifying certain tools. 

Some organizations have more stringent protections than others, and some do not apply security controls equally throughout. There may be policies applied to certain machines that can make enumeration more difficult that are not applied on other machines.


\subsection{General software discovery}

\begin{verbatim}
 wmic product get name

Get-WmiObject -Class Win32_Product |  select Name, Version
\end{verbatim}


\subsection{UAC}
\url{https://book.hacktricks.xyz/windows-hardening/authentication-credentials-uac-and-efs#check-uac}

\subsection{Microsoft Defender}

See\ref{windowd_knowledge:fundamentals:security:defender}

\href{https://docs.microsoft.com/en-us/powershell/module/defender/get-mpcomputerstatus?view=windowsserver2022-ps&viewFallbackFrom=win10-ps}{Get-MpComputerStatus}

\begin{verbatim}
Get-MpComputerStatus
\end{verbatim}

\url{https://book.hacktricks.xyz/windows-hardening/av-bypass}

\subsection{AppLocker}
See~\ref{windowd_knowledge:fundamentals:security:applocker}

\href{https://docs.microsoft.com/en-us/powershell/module/applocker/get-applockerpolicy?view=windowsserver2019-ps}{
GetAppLockerPolicy} can be used to enumerate Applocker tules but also to test a
software

\begin{verbatim}
Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections
\end{verbatim}

\begin{verbatim}
Get-AppLockerPolicy -Local | 
    Test-AppLockerPolicy -path C:\Windows\System32\cmd.exe -User Everyone
\end{verbatim}



\subsection{PowerShell Constrained Language Mode}

Organizations often focus on blocking the PowerShell.exe executable, but forget about the other PowerShell executable locations such as 

\verb+%SystemRoot%\SysWOW64\WindowsPowerShell\v1.0\powershell.exe+ or
\verb+PowerShell_ISE.exe+

Sometimes, there are  more stringent AppLocker policies that require more creativity to bypass.


PowerShell
\href{https://devblogs.microsoft.com/powershell/powershell-constrained-language-mode/}{Constrained
Language Mode} locks down many of the features needed to use PowerShell
effectively, such as blocking COM objects, only allowing approved \verb+.NET+ types, XAML-based workflows, PowerShell classes, and more. 

We can quickly enumerate whether we are in Full Language Mode or Constrained Language Mode.

\begin{verbatim}
$ExecutionContext.SessionState.LanguageMode
\end{verbatim}

\subsection{LAPS}

see~\ref{windows_knowledge:ad:security:laps}.

Aim:  enumerate what domain users can read the LAPS password set for machines
 with LAPS installed and what machines do not have LAPS installed. 

The \href{https://github.com/leoloobeek/LAPSToolkit}{LAPSToolkit} greatly
 facilitates this with several functions:
 \begin{itemize}
    \item {\bf \verb+Find-LAPSDelegatedGroups+}: parse \verb+ExtendedRights+ for all computers with LAPS enabled.  This will show groups specifically delegated to read LAPS passwords, which are often users in protected groups. An account that has joined a computer to a domain receives All Extended Rights over that host, and this right gives the account the ability to read passwords. 
    \item {\bf \verb+Find-AdmPwdExtendedRights+} checks the rights on each computer
        with LAPS enabled for any groups with read access and users with "All
        Extended Rights."  (can read LAPS passwords and may be less protected).
    \item {\bf \verb+Get-LAPSComputers+}  search for computers that have
            LAPS enabled when passwords expire, and even the randomized
        passwords in cleartext if our user has access.
\end{itemize}

\href{https://akijosberryblog.wordpress.com/2019/01/01/malicious-use-of-microsoft-laps/}{Abusing
LAPS}
