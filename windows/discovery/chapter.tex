\chapter{Discovery (TA0007)}
\begin{tabularx}{\linewidth}{|l|l|X|}
    \hline
ID &	Name &	Description \\
    \hline
T1087 &	Account Discovery &	\\
    \hline
T1010 &	Application Window Discovery &	listing of open application windows to
discover how the system is used.
information collected by a keylogger.\\
    \hline
T1217 &	Browser Bookmark Discovery &	\\
    \hline
T1580 & Cloud Infrastructure Discovery &\\
    \hline
T1538 &	Cloud Service Dashboard &\\
    \hline
T1526 &	Cloud Service Discovery &\\
    \hline
T1619 &	Cloud Storage Object Discovery &\\
    \hline
T1613 &	Container and Resource Discovery& \\  
    \hline
T1622 &	Debugger Evasion& \\ 
    \hline
T1482 &	Domain Trust Discovery& \\  
    \hline
T1083 &	File and Directory Discovery & \\ 
    \hline
T1615 &	Group Policy Discovery& \\  
    \hline
T1046 &	Network Service Discovery& \\ 
    \hline
T1135 &	Network Share Discovery& \\  
    \hline
T1040 &	Network Sniffing & \\ 
    \hline
T1201 &	Password Policy Discovery& \\ 
    \hline
T1120 &	Peripheral Device Discovery& \\ 
    \hline
T1057 &	Process Discovery& \\ 
    \hline
T1012 &	Query Registry& \\ 
    \hline
T1018 &	Remote System Discovery & \\
    \hline
T1518 &	Software Discovery& \\ 
    \hline
T1082 &	System Information Discovery& \\ 
    \hline
T1614 &	System Location Discovery& \\ 
    \hline
T1016 &	System Network Configuration Discovery& \\
    \hline
T1049 &	System Network Connections Discovery & \\
    \hline
T1033 &	System Owner/User Discovery 	& \\
    \hline
T1007 &	System Service Discovery& \\
    \hline
T1124 &	System Time Discovery& \\
    \hline
T1497 &	Virtualization/Sandbox Evasion& \\
\hline
\end{tabularx}

\input{windows/discovery/system}
\input{windows/discovery/account}
\input{windows/discovery/groups}
\input{windows/discovery/pass-pol}

\input{windows/discovery/network}
\input{windows/discovery/security}

\section{Process (T1057) and services (T1007) Discovery}
See~\ref{windows_knowlege:services_and_processes}

Looking at running processes provide a better idea of what applications are
currently running on the system. Being able to spot standard processes/services
quickly will help speed up enumeration and enable to hone in on non-standard
processes/services, which may open up a privilege escalation path. 


\begin{verbatim}
tasklist /svc
\end{verbatim}

\subsection{Permission discovery}

\begin{verbatim}
# query a service
sc qc <SERVICE_NAME>


sc //hostname or ip

sc stop <SERVICE_NAME>

# requiere elevated privileges
sc config wuauserv binPath=C:\Winbows\Perfectlylegitprogram.exe

# Displays a service's security descriptor, using the 
# Security Descriptor Definition Language (SDDL)
\verb+sc sdshow wuauserv+
\end{verbatim}


\verb+ Get-ACL -Path HKLM:\System\CurrentControlSet\Services\wuauserv | Format-List+

\subsection{Communication discovery}
\href{https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/netstat}{netstat}
(\verb+netstat -ano+) command displays active TCP and UDP connections which
provide a better idea of what services are listening on which port(s) both
locally and accessible to the outside. There may be vulnerable services only
accessible to the local host hat we can exploit to escalate privileges.

The main thing to look for with Active Network Connections are entries
listening on loopback addresses (127.0.0.1 and ::1) that are not listening on
the IP Address or broadcast (0.0.0.0, ::/0). The reason for this
is network sockets on localhost are often insecure due to the thought that
"they aren't accessible to the network." For example the local socket listening
on port 14147, used for FileZilla's administrative interface, can be used to
extract FTP passwords in addition to creating an FTP Share at  as the FileZilla
Server user (potentially Administrator).

\href{https://docs.microsoft.com/en-us/sysinternals/downloads/pipelist}{pipelist}
(pipelist.exe /accepteula) from the Sysinternals suite or \verb+Get-childItem \\.\pipe\+ will allow to enumerate instances
of named pipes.

\href{https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk}{Accesschk}
can be used to enumerate the permissions assigned to a specific named pipe by
reviewing the Discretionary Access List (DACL), which shows who has the
permissions to modify, write, read, or execute a resource. 

\verb+accesschk.exe /accepteula \\.\Pipe\lsass -v+


