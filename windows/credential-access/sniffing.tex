\section{Network sniffing (T1040)}
\label{mitre:t1040}
Beside the classic \verb+tcpdump+ and \verb+wieshark+, the tool
\href{https://github.com/DanMcInerney/net-creds}{net-creds} can be run from
linux to sniff passwords and hashes from a live interface or a pcap file.  It
is worth letting this tool run in the background during an assessment or
running it against a pcap to see if we can extract any credentials useful for
privilege escalation or lateral movement.

\subsection{Hash Sniffing}
\label{windows:ad:hash-sniff}
\subsubsection{LLMNR/NBT-NS Man-in-the-Middle}

see NetBIOS~\ref{network:netbios:spoofing} and
LLMR~\ref{network:llmnr:spoofing} MitM attack that allow finding some hashes.

Use reponder~\ref{tool:responder:mitm} in man in the middle then crack NTLMv2
hasheds with hashcat~\ref{tool:hashcat} or JtR~\ref{tool:jtr} or used in an
\href{https://heimdalsecurity.com/blog/what-is-an-smb-relay-attack/}{SMB Relay
attack} if the right conditions exist.

{\bf Note}: 
\begin{itemize}
    \item some technics (on web pentesting) allow to force a web server to look
        for an invalid host.
    \item SCF and URL file attack~\ref{windows:ad:scf-url} against writeable share
\end{itemize}

\subsection{SCF and URL file attack}
\label{windows:ad:scf-url}

This attack consist in dropping files in shares in order to increase the
success rate of sniffing for hashes attack~\ref{windows:ad:hash-sniff}

\url{https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md#scf-and-url-file-attack-against-writeable-share}

\subsection{Process Command Lines}

\begin{verbatim}
while($true)
{

  $process = Get-WmiObject Win32_Process | Select-Object CommandLine
  Start-Sleep 1
  $process2 = Get-WmiObject Win32_Process | Select-Object CommandLine
  Compare-Object -ReferenceObject $process -DifferenceObject $process2

}
\end{verbatim}
