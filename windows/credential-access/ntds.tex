\section{NTDS.DIT}
\label{mitre:t1003.003}
\subsection{bruteforce / spraying}

\subsection{Capturing NTDS.dit}
If a local admin or a domain admin is controlled it is possible to connect on a
DC (using \verb+evil-winrm+ for example) dump the \verb+ntds.dit+ using
\href{https://docs.microsoft.com/en-us/windows-server/storage/file-server/volume-shadow-copy-service}{shadow
copy} the exfiltrate the file and crack it offline with
CrackMapExec~\ref{tool:crackmapexec} (\verb+--ntds+),
secretsdump~\ref{tool:impacket:secretsdump} or PowerShell DSInternals module


\begin{verbatim}
vssadmin CREATE SHADOW /For=C:
cmd.exe /c copy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy2\Windows\NTDS\NTDS.dit c:\NTDS\NTDS.dit
\end{verbatim}


