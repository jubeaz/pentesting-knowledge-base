\section{SAM dumping}
\label{mitre:t1003.002}
See~\ref{win:SAM} is found in \verb+C:\Windows\System32\config+ and passwords  that are
hashed and saved in SAM can found in the registry
Editor and navigate yourself to \verb+HKEY_LOCAL_MACHINE\SAM.+

When the Windows operating system is running, the hives are in use and mounted.
When Windows is not running, the hives are not mounted and they can be copied
just like any other file.


SAM secrets can be dumped locally or remotely from the mounted registry hives.
These secrets can also be extracted offline from the exported hives. 



With a local acdmin access there arethree registry hives to consider. Each will have a specific purpose: 
\begin{itemize}
    \item \verb+HKLM\SAM+: Contains the hashes associated with local account
        passwords. 
    \item \verb+HKLM\SYSTEM+: Contains the system bootkey, which is used to encrypt the SAM database. 
    \item \verb+HKLM\SECURITY+: Contains cached credentials for domain accounts. 
\end{itemize}


\subsection{local dumping and Offline hashes dumping}
To perform an offline hash dumping attack the three registry hives must be
exfiltrated after beeing dumped on disk.

Backups are created using the \verb+reg.exe+ utility.
\begin{verbatim}
C:\WINDOWS\system32> reg.exe save hklm\sam C:\sam.save
C:\WINDOWS\system32> reg.exe save hklm\system C:\system.save
C:\WINDOWS\system32> reg.exe save hklm\security C:\security.save
\end{verbatim}

Tools to use:
\begin{itemize}
    \item Impacket's secretsdump.py\ref{tool:impacket:secretsdump:offline} 
    \item Mimikatz~\ref{tool:mimikatz:cred-dumping}
\end{itemize}


\subsection{Remote hashes dumping}
Tools to use:
\begin{itemize}
    \item Impacket's secretsdump.py\ref{tool:impacket:secretsdump:remote:SAM} 
    \item CrackMapExec~\ref{tool:crackmapexec:smb:cred-dumping}
    \item metasploit ifor windows 7 (\verb+Invoke-PowerDump.ps1+ and
        \verb+Get-PassHashes.ps1+)
    \item metasploit ifor windows 7 (\verb+kiwi+ or \verb+hashdump+ +
        \verb+credential_collector+)
\end{itemize}

\subsection{Links}
\url{https://attack.mitre.org/techniques/T1003/002/}
