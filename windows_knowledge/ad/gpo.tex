\section{Group Policy}

While Group Policy is an excellent tool for managing the security of a domain,
it can also be abused. Gaining rights over a Group Policy Object could lead to
lateral movement, privilege escalation, and even full domain compromise.

They can also be used as a way for an attacker to maintain persistence within a network. 

\subsection{\gls{win:GPO}}
\index{Active Directory!Group Policy Object}
\url{https://docs.microsoft.com/en-us/previous-versions/windows/desktop/policy/group-policy-objects}

A \gls{win:GPO} is a virtual collection of policy settings that can
be applied to user(s) or computer(s). 

Every \gls{win:GPO} has a unique name and is assigned a unique \gls{win:GUID}. 

They can be linked to a specific \gls{win:OU}, \gls{win:domain}, or \gls{win:site}. 

\subsection{Order of Precedence}
GPOs are processed from the top down when viewing them from a domain organizational standpoint. 

A GPO linked to an OU at the highest level in an Active Directory network (at the domain level, for example) would be processed first, followed by those linked to a child OU, etc. 

One more thing to keep track of with precedence is that a setting configured in Computer policy will always have a higher priority of the same setting applied to a user.

\begin{tabularx}{\linewidth}{|l|X|}
    \hline
Level &	Description \\
    \hline
Local Group Policy &	The policies are defined directly to the host locally
outside the domain. Any setting here will be overwritten if a similar setting
is defined at a higher level. \\
    \hline
Site Policy  &	Any policies specific to the Enterprise Site that the host
resides in. Access Control policies are a great example of this. This is also a
great way to perform actions like printer and share mapping for users in
specific sites. \\
    \hline
Domain-wide Policy & Any settings you wish to have applied across the domain as
a whole. For example, setting the password policy complexity level, configuring
a Desktop background for all users, and setting a Notice of Use and Consent to
Monitor banner at the login screen. \\
    \hline
Organizational Unit (OU) & These settings would affect users and computers who
belong to specific OUs. You would want to place any unique settings here that
are role-specific. For example, the mapping of a particular share drive that
can only be accessed by HR, access to specific resources like printers, or the
ability for IT admins to utilize PowerShell and command-prompt. \\
    \hline
nested OU Policies &	Settings at this level would
reflect special permissions for objects within nested OUs. For example,
providing Security Analysts a specific set of Applocker policy settings that
differ from the standard IT Applocker settings. \\
    \hline
\end{tabularx}

We can manage Group Policy from the Group Policy Management Console or using the PowerShell GroupPolicy module via command line. 

The Default Domain Policy is the default GPO that is automatically created and linked to the domain. 

It has the highest precedence of all GPOs and is applied by default to all users and computers. 

Generally, it is best practice to use this default GPO to manage default settings that will apply domain-wide. 

The Default Domain Controllers policy is also created automatically with a domain and sets baseline security and auditing settings for all domain controllers in a given domain. It can be customized as needed, like any GPO.

\subsubsection{Enforced GPO Policy Precedence}

It is possible to specify the \verb+Enforced+ option to enforce settings in a specific GPO. 

If this option is set, policy settings in GPOs linked to lower OUs CANNOT override the settings. 

If a GPO is set at the domain level with the Enforced option selected, the settings contained in that GPO will be applied to all OUs in the domain and cannot be overridden by lower-level OU policies. 

\subsubsection{Block inheritance}
It is also possible to set the \verb+Block inheritance+ option on an OU. If this is specified for a particular OU, then policies higher up (such as at the domain level) will NOT be applied to this OU. If both options are set, the No Override option has precedence over the Block inheritance option. 

\subsection{Group Policy Refresh Frequency}

We can modify the refresh interval via Group Policy by clicking on Computer Configuration --> Policies --> Administrative Templates --> System --> Group Policy and selecting Set Group Policy refresh interval for computers

\subsection{Security Considerations of GPOs}

As mentioned earlier, GPOs can be used to carry out attacks. These attacks may include adding additional rights to a user account that we control, adding a local administrator to a host, or creating an immediate scheduled task to run a malicious command such as modifying group membership, adding a new admin account, establishing a reverse shell connection, or even installing targeted malware throughout a domain. These attacks typically happen when a user has the rights required to modify a GPO that applies to an OU that contains either a user account that we control or a computer.

