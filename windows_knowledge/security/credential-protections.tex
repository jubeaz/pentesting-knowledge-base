\section{LSASS Credential protections}


\subsection{Protected Process Light (RunAsPPL)}
\label{windows:ppl}

\href{https://itm4n.github.io/lsass-runasppl/}{Do You Really Know About LSA Protection (RunAsPPL)?}


\subsection{Restricted Admin}
\label{windows:retricted_admin}

Restricted Admin Mode was introduced in Windows 8.1 as an attempt to prevent credential exposure via RDP. While well intentioned, this unfortunately introduced the ability to pass-the-hash to RDP.

When this mode is enabled the RDP client will not send plain-text or any other re-usable form of credentials to the remote PC or Server. 

when trying to perform a rdp pth if the mode is disabled then the following error should be visible:
\begin{verbatim}
Account restrictions are preventing this user from signing in. For example: blan passwords aren't...
\end{verbatim}

Restricted Admin mode allows logging in to an RDP host without transmitting login credentials over the network. To do this, it redirects the Kerberos requests back to the client that wants to establish the connection.

Restricted Admin mode requires that the user be a member o the Local Administrators group on the RDP server.


\subsection{(Remote) Credential guard}

\subsubsection{Credential guard}
\label{windows:credential_guard}
Credential Guard is a virtualization-based isolation technology for LSASS which prevents attackers from stealing credentials that could be used for pass the hash attacks.

Credential Guard was introduced with Microsoft's Windows 10 operating system. As of Windows 10 version 20H1, Credential Guard is only available in the Enterprise edition of the operating system.

\href{https://syfuhs.net/how-windows-defender-credential-guard-works}{how windows defender credential guard works}

\subsubsection{Remote Credential guard}
\label{windows:remote_credential_guard}
fonctionnalité de sécurité qui vise elle aussi à protéger les informations d’identification sur les connexions Bureau à distance en générant des tickets de service nécessaires à partir de la machine source au lieu de copier les informations d’authentification (Haches et TGT) vers la machine cible.

Cette fonctionnalité peut être considérée comme le successeur /remplaçant du mode « Restricted Admin ».

\href{https://syfuhs.net/how-does-remote-credential-guard-work}{how does remote credential guard work}


Remote Credential Guard is suitable for all users as long as they are members of the Remote Desktop Users group on the host.


As expected, while Remote Credential Guard only allows authentication using Kerberos, Restricted Admin mode also supports NTLM. Other differences between the two methods are as follows:
\begin{itemize}
    \item 
        As the name suggests, Restricted Admin mode requires that the user be a member of the Local Administrators group on the RDP server. Remote Credential Guard is suitable for all users as long as they are members of the Remote Desktop Users group on the host.
    \item 
        Remote Credential Guard provides SSO for the locally logged-in user; authentication under other accounts is not possible. Restricted Admin mode does not have this limitation.
    \item 
        If you want to access other network resources from the remote host, this is done in Restricted Admin mode under the remote computer's account. This results in a multihop problem if the computer account lacks the necessary permissions. Remote Credential Guard, on the other hand, always connects the users under their own identity.
    \item 
        Restricted Admin mode is the older technology and was already available for Windows 7 or Server 2008 R2 (with a corresponding patch level). Remote Credential Guard, on the other hand, requires at least Windows 10 1607 or Server 2016 for both the client and the server. Furthermore, it only supports the traditional client mstsc.exe but not the UWP app.
\end{itemize}

