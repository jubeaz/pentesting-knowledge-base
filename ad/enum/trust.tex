\section{Domain Trust (T1482)}
\label{mitre:t1482}


\href{https://github.com/HarmJ0y/TrustVisualizer}{TrustVisualizer}

\href{https://github.com/dirkjanm/ldapdomaindump}{ldapdomaindump}


\verb+FOREST_TRANSITIVE | TREAT_AS_EXTERNAL+ due to Sid history enabled:
{\emph If this bit is set, then a cross-forest trust to a domain is to be treated as an external trust for the purposes of SID Filtering. Cross-forest trusts are more stringently filtered than external trusts. This attribute relaxes those cross-forest trusts to be equivalent to external trusts. For more information on how each trust type is filtered, see [MS-PAC] section 4.1.2.2.}

/bin/bash: line 1: q: command not found


\subsection{domain trust}
\subsubsection{Powershell}
\begin{verbatim}

nltest /domain_trust /ALL_TRUSTS /V [/server:<dest_dc_fqdn>]
\end{verbatim}

\begin{verbatim}
import-module activedirectory; get-adtrust

import-module activedirectory; Get-ADDomain <domain> | get-adtrust
\end{verbatim}

ForestTransitive: true for Forest or external trust

IntraForest: for Parent-Child

\begin{itemize}
    \item SIDFilteringForestAware: Set to True if a forest trust is configured for selective authentication
    \item SIDFilteringQuarantined: Set to True when SID filtering with quarantining is used for a trust. Used for external trusts only.
    \item TrustAttributes:\url{https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e9a2d23c-c31e-4a6f-88a0-6646fdb51a3c?redirectedfrom=MSDN}
\end{itemize}

\url{https://learn.microsoft.com/en-us/answers/questions/590696/ad-trust-attribute}



\subsubsection{LDAP}
\begin{verbatim}
dsquery * -filter "(objectClass=trustedDomain)" -attr * -s <dest_dc_fqdn>
ldapsearch -H ldap://test.local -b DC=test,DC=local "(objectclass=trusteddomain)"
\end{verbatim}

\subsubsection{ldeep}

\begin{verbatim}
ldeep ldap -u <user> -p '<password>' -d <domain_fqdn> -s ldap://<dc_ip> trusts
\end{verbatim}

\subsubsection{Powerview}

\begin{verbatim}
Get-DomainTrust
Get-DomainTrustMapping
\end{verbatim}


\subsubsection{BloodHound}
\verb+-CollectionMethod trusts+ and \verb+-Domain <foreign.domain.fqdn>+ then \verb+Map Domain Trusts+


Get-Domain function uses LDAP enumeration, meaning that we can pull said information from a domain that trusts us. This is done with the -Domain <domain.fqdn> parameter.

\begin{verbatim}
Get-DomainComputer -Domain <TARGET_DOMAIN>
Get-DomainUser -Domain <TARGET_DOMAIN>
...
\end{verbatim}


\subsection{Forest trust}

\subsubsection{Powershell}
\begin{verbatim}
import-module activedirectory; get-adforest | get-adtrust
\end{verbatim}



\subsection{domain trust bridges (Foreign Relationship)}
\url{https://www.dropbox.com/s/ilzjtlo0vbyu1u0/Carlos%20Garcia%20-%20Rooted2019%20-%20Pentesting%20Active%20Directory%20Forests%20public.pdf?dl=0}

\subsubsection{Bloodhound}


\subsubsection{Local Group Membership}
This involves enumerating the local memberships of one or more systems through remote SAM (SAMR) or through GPO correlation

\subsubsection{Foreign Group Membership}
\begin{itemize}
    \item \verb+Get-DomainForeignUser+: Enumerates users who are in groups outside of the user's domain. This is a domain's "outgoing" access.
    \item \verb+Get-DomainForeignGroupMember+: Enumerates groups with users outside of the group's domain and returns each foreign member. This is a domain's "incoming" access.
\end{itemize}

Bloodhound \verb+User with Foreign Domain Group Membership+ and \verb+Groups with Foreigh Domain Group Membership+

\subsubsection{Foreign ACL Principals}

