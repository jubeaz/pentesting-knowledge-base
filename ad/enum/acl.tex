\section{ACL Discovery}

\subsection{ACL of an AD Object}
\subsubsection{dsacls}

\begin{verbatim}
dsacls.exe "cn=Yolanda,cn=users,dc=inlanefreight,dc=local"
dsacls.exe "cn=Yolanda,cn=users,dc=inlanefreight,dc=local" | Select-String "Pedro" -Context 1,10
\end{verbatim}


\subsubsection{PowerShell}
requiere \verb+DirectoryServices+ and \verb+ActiveDirectorySecurity+
\begin{verbatim}
$directorySearcher = New-Object System.DirectoryServices.DirectorySearcher('(samaccountname=Yolanda)')
$directorySearcher.SecurityMasks = [System.DirectoryServices.SecurityMasks]::Dacl -bor [System.DirectoryServices.SecurityMasks]::Owner
$binarySecurityDescriptor = $directorySearcher.FindOne().Properties.ntsecuritydescriptor[0]
Write-Host -NoNewline $binarySecurityDescriptor

$parsedSecurityDescriptor = New-Object System.DirectoryServices.ActiveDirectorySecurity
$parsedSecurityDescriptor.SetSecurityDescriptorBinaryForm($binarySecurityDescriptor)
$parsedSecurityDescriptor.Access

$parsedSecurityDescriptor.Access | Where-Object {$_.IdentityReference -like '*Pedro*'}
\end{verbatim}



\subsubsection{tools}
The principle is to start for each account controlled to check their ACL and if
an interesstin right is available on another account continue the path to see
where it can leads. Remember to check Nested groups.

Tools used:
\begin{itemize}
    \item PowerView \verb+Get-DomainObjectAcl+~\ref{tool:powerview:ACL_enum}
    \item \href{https://github.com/canix1/ADACLScanner}{ADACLScanner}
    \item bloodhound
    \item Impacket \verb+dacledit+~\ref{tool:impacket:dacledit}
\end{itemize}


\subsection{ACL of a process}
\subsubsection{Using AccessChk}

\begin{verbatim}
.\accesschk64.exe -p "explorer.exe" -l
\end{verbatim}

