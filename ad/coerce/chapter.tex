\chapter{Coreced auths attacks}
\label{ad:auth-coercion}
\section{Introduction}

regardless of there being a plethora of them, almost all use the same sequence of operations:
\begin{enumerate}
    \item 
        Authenticate to a remote machine using valid domain credentials (usually over SMB).
    \item
        Connect to a remote SMB pipe such as \verb+\PIPE\netdfs+, \verb+\PIPE\efsrpc+, \verb+\PIPE\lsarpc+, or \verb+\PIPE\lsass+.
    \item
        Bind to an RPC protocol to call its methods on an arbitrary target machine.
\end{enumerate}


\subsection{DC coercion}

coercing a DC to authenticate allow the following attacks:
\begin{itemize}
    \item Relay the connection to another DC and perform DCSync (if SMB Signing is disabled).
    \item Force the Domain Controller to connect to a machine configured for Unconstrained Delegation (UD) (case of a DC) - this will cache the TGT in the memory of the UD server, which can be captured/exported with tools like Rubeus and Mimikatz.
    \item Relay the connection to Active Directory Certificate Services to obtain a certificate for the Domain Controller. Threat agents can then use the certificate on-demand to authenticate and pretend to be the Domain Controller (e.g., DCSync).
    \item Relay the connection to configure Resource-Based Kerberos Delegation for the relayed machine. We can then abuse the delegation to authenticate as any Administrator to that machine.
\end{itemize}

\input{ad/coerce/printerbug}
\input{ad/coerce/printspooler}
\input{ad/coerce/petitpotam}
\input{ad/coerce/shadowcoerce}
\input{ad/coerce/dfscoerce}

\section{tools}
\subsection{coercer}
\begin{verbatim}
$ Coercer -u user -p password123 -d vuln.local -l srv.vuln.local -t dc.vuln.local
\end{verbatim}

\section{links}
\begin{itemize}
    \item 
        \href{https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications}{The
        Hacker Recipes :  MITM and coerced auths}
\end{itemize}
