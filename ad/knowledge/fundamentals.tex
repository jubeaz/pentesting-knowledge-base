\section{Fundamentals}
\subsection{Global Uniqque ID (GUID)}
objects have a globally unique identifier (GUID) assigned to them by the system
at creation. This 128-bit number is the Microsoft implementation of the
universally unique identifier (UUID) concept from Digital Equipment
Corporation.

The object’s GUID stays with the object until it is deleted, regardless of
whether it is renamed or moved within the directory information tree (DIT). The
ob‐ ject’s GUID will also be preserved if you move an object between domains
within a multidomain forest.

\subsection{Distinguished names (DN)}
Hierarchical paths in Active Directory are known as {\bf distinguished names} and can be
used to uniquely reference an object. Distinguished names are defined in the LDAP
standard as a means of referring to any object in the directory.

\subsection{Relative Distinguished names (RDN)}
A {\bf relative distinguished name (RDN)} is the name used to uniquely
reference an object within its parent container in the directory. For example,
this is the DN for the default Administrator account in the Users container in
the mycorp.com domain:
\begin{verbatim}
      cn=Administrator,cn=Users,dc=mycorp,dc=com
\end{verbatim}

This is the RDN of the user:
\begin{verbatim}
cn=Administrator
\end{verbatim}

RDNs must always be unique within the container in which they exist.

All RDNs use a prefix to indicate the class of the object that is being
referred to. Any object class that does not have a specific letter code uses
the default of \verb+cn+.

Active Directory supports the following object class:
\begin{verbatim}
CN (common name)
L (Locality name)
O (Organization name)
OU (Organizational unit name)
C (Country name)
DC (Domain component)
\end{verbatim}

\subsection{Domain and Domain Tree}
Active Directory’s logical structure is built around the concept of domains. 

An Active Directory domain is made up of the following components:
\begin{itemize}
    \item  An X.500-based hierarchical structure of containers and objects
    \item  A DNS domain name as a unique identifier
    \item  A security service, which authenticates and authorizes any access to
        resources via accounts in the domain or trusts with other domains
    \item  Policies that dictate how functionality is restricted for users or
        machines within that domain
\end{itemize}

A domain controller (DC) can be authoritative for one and only one domain. It
is not possible to host multiple domains on a single DC.

{\bf Domain tree} is a series of domains connected together in a hierarchical
fashion, all using a contiguous naming scheme.

A domain tree is called by the name given to the root of the tree

Trees ease management and access to resources, as all the domains in a domain
tree trust one another implicitly with transitive trusts.

\subsection{Forest}
A {\bf forest} is a collection of one or more domain trees.

These domain trees share a common {\bf Schema} and {\bf Configuration
container}, and the trees as a whole are connected together through transitive
trusts.

A forest is named after the first domain that is created, also known as the
forest root domain.


\subsection{Trusts}
\label{active-directory:trust}

An Active Directory (AD) Forest is the security and administrative boundary for
objects and entities.
\href{https://social.technet.microsoft.com/wiki/contents/articles/50969.active-directory-forest-trust-attention-points.aspx}{trust}
is used to establish \verb+forest-forest+ or \verb+domain-domain+
authentication, allowing users to access resources in (or administer)  another
domain outside of the domain their account resides in. A trust  creates a link
between the authentication systems of two domains.

There are several trust types:

\begin{tabularx}{\linewidth}{|l|X|}
    \hline
Trust Type & Description \\
    \hline
Parent-child & Domains within the same forest. The child domain has a two-way
transitive trust with the parent domain. \\
    \hline
Cross-link & a trust between child domains to speed up authentication. \\
    \hline
External & A non-transitive trust between two separate domains in separate
forests which are not already joined by a forest trust. This type of trust
utilizes
\href{https://www.serverbrain.org/active-directory-2008/sid-history-and-sid-filtering.html}{SID
filtering}. \\
    \hline
Tree-root & a two-way transitive trust between a forest root domain and a new
tree root domain. They are created by design when you set up a new tree root
domain within a forest. \\
    \hline
Forest & a transitive trust between two forest root domains.\\ 
    \hline
\href{https://docs.microsoft.com/en-us/security/compass/esae-retirement}{ESAE}
    & A bastion forest used to manage Active Directory which is becoming
    obsolete\\
\end{tabularx}

\begin{figure}
  \includegraphics[width=\linewidth]{ad/knowledge/images/trusts.png}
  \caption{AD trusts}
  \label{fig:ad-trusts}
\end{figure}

Trusts can be:
\begin{itemize}
\item transitive: trust is extended to objects that the child domain trusts.
\item non-transitive: only the child domain itself is trusted.
\end{itemize}


Trusts can be set up:
\begin{itemize}
    \item bidirectional: users from both trusting domains can access resources.
    \item In a one-way trust: only users in a trusted domain can access resources in a trusting domain, not vice-versa. The direction of trust is opposite to the direction of access.
\end{itemize}

Often, domain trusts are set up improperly and provide unintended  attack
paths. Also, trusts set up for ease of use may not be reviewed  later for
potential security implications. Mergers and acquisitions can  result in
bidirectional trusts with acquired companies, unknowingly  introducing risk
into the acquiring company's environment. It is not  uncommon to be able to perform an attack such as Kerberoasting against a  domain outside the principal domain and obtain a user that has  administrative access within the principal domain.


