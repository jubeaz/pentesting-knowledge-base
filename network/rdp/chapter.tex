\chapter{RDP: Remote Desktop Protocol}
\url{https://www.hackingarticles.in/remote-desktop-penetration-testing-port-3389/}
\input{network/rdp/intro}
\input{network/rdp/enum}

\section{Interaction}
\subsection{xfreerdp}


\input{network/rdp/bruteforce}
\section{Session Hijacking}
To successfully impersonate a user without their password, we need to have
\verb+SYSTEM+ privileges and use the Microsoft
\href{https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/tscon}{tscon.exe} binary that enables users to connect to another desktop session.

\begin{verbatim}
# get sessions names
query user 

tscon #{TARGET_SESSION_ID} /dest:#{OUR_SESSION_NAME}
\end{verbatim}


With \verb+local administrator+ privileges, there are several methods to obtain
\verb+SYSTEM+ privileges, such as
\href{https://docs.microsoft.com/en-us/sysinternals/downloads/psexec}{PsExec}
or \href{https://github.com/gentilkiwi/mimikatz}{Mimikatz}. A simple trick is
to create a Windows service using
\href{https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/sc-create}{Microsoft
sc.exe} that, by default, will run as Local System and will execute any binary with SYSTEM privileges. 

\begin{verbatim}
sc.exe create sessionhijack binpath= "cmd.exe /k tscon 1 /dest:rdp-tcp#0"
net start sessionhijack
\end{verbatim}
Once the service is started, a new terminal with the lewen user session will appear.


\section{Pass the hash}

\begin{verbatim}
reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f
\end{verbatim}

Once the registry key is added, we can use xfreerdp with the option /pth to
gain RDP access.

\input{network/rdp/mitm}
\input{network/rdp/postexploit}


