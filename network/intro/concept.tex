
\section{The concept of attack}

To effectively understand attacks on the different services, we should look at
how these services can be attacked. A concept is an outlined plan that is
applied to future projects. 

we can try to group the services SSH, FTP, SMB, and HTTP ourselves and figure
out what these services have in common. Then we need to create a structure that
will allow us to identify the attack points of these different services using a
single pattern.

Analyzing commonalities and creating pattern templates that fit all conceivable
cases is not a finished product but rather a process that makes these pattern
templates grow larger and larger. Therefore, we have created a pattern template
for this topic for you to better and more efficiently teach and explain the
concept behind the attacks.

\begin{figure}
  \includegraphics[width=\linewidth]{network/intro/images/attack_concept.png}
  \caption{Attack concept}
  \label{fig:attack_concept}
\end{figure}
The concept is based on four categories that occur for each vulnerability.
First, the {\bf Source} that performs the specific request to a {\bf Process}
where the vulnerability gets triggered. Each process has a specific set of {\bf
Privileges} with which it is executed. Each process has a task with a specific
goal or {\bf Destination} to either compute new data or forward it. However,
the individual and unique specifications under these categories may differ from
service to service.

Every task and piece of information follows a specific pattern, a cycle, which
we have deliberately made linear. This is because the {\bf Destination} does
not always serve as a {\bf Source} and is therefore not treated as a source of
a new task.

For any task to come into existence at all, it needs an idea, information
(Source), a planned process for it (Processes), and a specific goal
(Destination) to be achieved. Therefore, the category of Privileges is
necessary to control information processing appropriately.

\subsection{Source}
Source can be generalized  as a source of information used for the specific
task of a process. There are many different ways to pass information to a
process. The graphic shows some of the most common examples of how information
is passed to the processes.

The source is, therefore, the source that is exploited for vulnerabilities. It
does not matter which protocol is used because HTTP header injections can be
manipulated manually, as can buffer overflows. The source for this can
therefore be categorized as Code. So let us take a closer look at the pattern
template based on
\href{https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2021-44228}{Log4j}.



Log4j is a framework or Library used to log application messages in Java and
other programming languages. This library contains classes and functions that
other programming languages can integrate. For this purpose, information is
documented, similar to a logbook. Furthermore, the scope of the documentation
can be configured extensively. As a result, it has become a standard within
many open source and commercial software products. In this example, an attacker
can manipulate the HTTP User-Agent header and insert a JNDI lookup as a command
intended for the Log4j library. Accordingly, not the actual User-Agent header,
such as Mozilla 5.0, is processed, but the JNDI lookup.


\subsection{Process}
The Process is about processing the information forwarded from the source.
These are processed according to the intended task determined by the program
code. For each task, the developer specifies how the information is processed.
This can occur using classes with different functions, calculations, and loops.
The variety of possibilities for this is as diverse as the number of developers
in the world. Accordingly, most of the vulnerabilities lie in the program code
executed by the process.

The process of Log4j is to log the User-Agent as a string using a function and
store it in the designated location. The vulnerability in this process is the
misinterpretation of the string, which leads to the execution of a request
instead of logging the events. However, before we go further into this
function, we need to talk about privileges.

\subsection{Privileges}
Privileges are present in any system that controls processes. These serve as a
type of permission that determines what tasks and actions can be performed on
the system. These privileges can also be used for different means. In computer
systems, these privileges serve as control and segmentation of actions for
which different permissions, controlled by the system, are needed. Therefore,
the rights are checked based on this categorization when a process needs to
fulfill its task. If the process satisfies these privileges and conditions, the
system approves the action requested.

What made the Log4j vulnerability so dangerous was the Privileges that the
implementation brought. Logs are often considered sensitive because they can
contain data about the service, the system itself, or even customers.
Therefore, logs are usually stored in locations that no regular user should be
able to access. Accordingly, most applications with the Log4j implementation
were run with the privileges of an administrator. The process itself exploited
the library by manipulating the User-Agent so that the process misinterpreted
the source and led to the execution of user-supplied code.

\subsection{Destination}

Every task has at least one purpose and goal that must be fulfilled. Logically,
if any data set changes were missing or not stored or forwarded anywhere, the
task would be generally unnecessary. The result of such a task is either stored
somewhere or forwarded to another processing point. Therefore we speak here of
the Destination where the changes will be made. Such processing points can
point either to a local or remote process. Therefore, at the local level, local
files or records may be modified by the process or be forwarded to other local
services for further use. However, this does not exclude the possibility that
the same process could reuse the resulting data too. If the process is
completed with the data storage or its forwarding, the cycle leading to the
task's completion is closed.

The misinterpretation of the User-Agent leads to a JNDI lookup which is
executed as a command from the system with administrator privileges and queries
a remote server controlled by the attacker, which in our case is the
Destination in our concept of attacks. This query requests a Java class created
by the attacker and is manipulated for its own purposes. The queried Java code
inside the manipulated Java class gets executed in the same process, leading to
a remote code execution (RCE) vulnerability.
