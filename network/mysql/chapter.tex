\chapter{MySQL}

\section{Introduction}
Usually, the MySQL server runs on TCP port 3306.


\subsection{Default system databases}

MySQL default system schemas/databases:
\begin{itemize}
    \item \verb+mysql+ is the system database that contains tables that store information required by the MySQL server
    \item
            \href{https://dev.mysql.com/doc/refman/8.0/en/system-schema.html#:~:text=The%20mysql%20schema%20is%20the,used%20for%20other%20operational%20purposes}{the
            System Schema (sys)} which contains tables, information, and
            metadata necessary for management.
    \item \verb+information_schema+: which contains metadata mainly retreived from the system schema. 
    \item \verb+performance_schema+ is a feature for monitoring MySQL Server execution at a low level
\end{itemize}

The reason for the existence of these two is the ANSI/ISO standard that has
been established. System schema is a Microsoft system catalog for SQL servers
and contains much more information than the information schema.

There is a widely covered
\href{https://dev.mysql.com/doc/refman/8.0/en/general-security-issues.html}{security
issues} section in the reference manual that covers best practices for securing
MySQL servers.

\subsection{Authentication mechanisms}
MySQL also supports different
\href{https://dev.mysql.com/doc/internals/en/authentication-method.html}{authentication
methods}, such as username and password, as well as Windows authentication
(plugin required). In addition, administrators can
\href{https://docs.microsoft.com/en-us/sql/relational-databases/security/choose-an-authentication-mode}{choose
an authentication mode} for many reasons, including compatibility, security,
usability, and more. However, depending on which method is implemented,
misconfigurations can occur.


\section{Dangerous Settings}
The settings {\bf user}, {\bf password}, and {\bf admin\_address} are
security-relevant because the entries are made in plain text. Often, the rights
for the configuration file of the MySQL server are not assigned correctly. If
we get another way to read files or even a shell, we can see the file and the
username and password for the MySQL server. Suppose there are no other security
measures to prevent unauthorized access. In that case, the entire database and
all the existing customers' information, email addresses, passwords, and
personal data can be viewed and even edited.


The {\bf debug} and {\bf sql\_warnings} settings provide verbose information
output in case of errors, which are essential for the administrator but should
not be seen by others. This information often contains sensitive content, which
could be detected by trial and error to identify further attack possibilities.
These error messages are often displayed directly on web applications.
Accordingly, the SQL injections could be manipulated even to have the MySQL
server execute system commands.

\section{Footprint / enumeration}

\subsection{nmap}

\begin{verbatim}
sudo nmap -sV -sC -p3306 --script mysql*
\end{verbatim}

\section{Interaction}

\subsection{mysql}
\begin{verbatim}
mysql -u USERNAME -pPASSWORD -h  IP

show databases;
select version();
use DATABASE_NAME;
show tables;
show columns from TABLE_NAME;

use sys ; -- system schema
user information_schema ; 
\end{verbatim}

\subsection{dbeaver}
\subsection{mysql workbench}

\section{Command execution}

MySQL supports
\href{https://rsc.anu.edu.au/~rsccu/manuals/mySQL/refman-5.0-en.html-chapter/extending-mysql.html#adding-udf}{User
Defined Functions} which allows us to execute C/C++ code as a function within
SQL, there's one User Defined Function for command execution in this
\href{https://github.com/mysqludf/lib_mysqludf_sys}{GitHub repository}. It is
not common to encounter a user-defined function like this in a production
environment, but we should be aware that we may be able to use it.

\section{Read / Write local files}
A global system variable
\href{https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_secure_file_priv}{secure\_file\_priv}
limits the effect of data import and export operations, such as those performed
by the LOAD DATA and SELECT â€¦ INTO OUTFILE statements and the
\href{https://dev.mysql.com/doc/refman/5.7/en/string-functions.html#function_load-file}{LOAD\_FILE()}
function. These operations are permitted only to users who have the
\href{https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html#priv_file}{FILE} privilege.

\begin{verbatim}
show variables like "secure_file_priv";
\end{verbatim}

\subsection{Write file}
\begin{verbatim}
SELECT 'XXX' INTO FILE 'PATH';
\end{verbatim}


\subsection{Read file}

\begin{verbatim}
select LOAD_FILE("/etc/passwd");
\end{verbatim}

\section{links}
\begin{itemize}
    \item 
\href{https://dev.mysql.com/doc/refman/8.0/en/system-schema.html#:~:text=The%20mysql%20schema%20is%20the,used%20for%20other%20operational%20purposes}{mysql
System Schema}
\end{itemize}

