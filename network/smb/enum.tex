\section{Footprint / enumeration}
\url{https://www.hackingarticles.in/a-little-guide-to-smb-enumeration/}
\label{network:smb:enum}

SMB protocol allow to enumerate lo of elements:
\begin{itemize}
    \item domain SID
    \item RID
    \item users
    \item pssword policy
    \item \ldots
\end{itemize}


\subsection{mount}

\begin{verbatim}
sudo mount -t cifs -o ro,username=TempUser,password=welcome2019 \
    '//10.10.10.178/Secure$' ./tmp/a
\end{verbatim}

\subsection{smbclient}
\begin{verbatim}
# detect Windows computers with shares
sudo smbtree -N
# enum shares with a user
smbclient -L //IP -U USER_NAME
# annymously list shared folders available on the computer
sudo smbclient -L //IP -N
# annymously connect to the network folde
smbclient //IP/SHARE_FOLDER -N

# Check NTFS ADS
smbclient -U USER //IP/Share -c 'allinfo "ADS_FILE"'
get "ADS_FILE:PASSWORD:$DATA"
\end{verbatim}


\subsection{nmap}

Usefull scripts (\verb+--script smb-*+):
\begin{itemize}
\item nbstat
\item smb-enum-shares
\item smb-protocols
\item smb2-capabilities
\item smb2-security-mode
\item smb2-time
\item smb-os-discovery
\end{itemize}

For vulnerabilities testing \verb+ --script smb-vuln*+

\subsection{Metasploit}
\begin{verbatim}
search type:exploit platform:windows target:2008 smb
# version
use auxiliary/scanner/smb/smb_version
# shares enum
use auxiliary/scanner/smb/smb_enumshares
# user enum
use auxiliary/scanner/smb/smb_lookupsid
#
use auxiliary/scanner/smb/smb_enumusers
\end{verbatim}

\subsection{rpcclient}
rpcclient~\ref{tool:rpcclient}offers many different requests on the SMB server
to get information. 


\begin{verbatim}
rpcclient -U "" 10.129.14.128
netshareenumall



for i in $(seq 500 1100); \
    do rpcclient -N -U "" IP -c "queryuser 0x$(printf '%x\n' $i)" \
    | grep "User Name\|user_rid\|group_rid" && echo "";done
\end{verbatim}

\subsection{CrackmapExec}
\verb+cme smb IP --shares -u '' -p ''+

\subsection{enum4linux}

\begin{verbatim}
# -a = all -u = login to prevent null session
enum4linux -a -u anonymous IP
enum4linux-ng IP  -A
enum4linux-ng IP  -S -u anonymous
\end{verbatim}

\subsection{nullinux}
Nullinux, using SMB, can list OS information, domain information, network shares, directories, and users. If the username and password are not specified in the command line arguments, then an anonymous login or null session is tried. Nullinux is a wrapper for Samba tools (smbclient and rpcclient) to list hosts using various techniques. 

\subsection{Impacket}

\subsubsection{Lookupsid}
\verb+python3 lookupsid.py DOMAIN/LOGIN:PASSWD@IP+

\subsubsection{samrdump}
\verb+python3 samrdump.py DOMAIN/LOGIN:PASSWD@IP+


\subsection{smb spider}
The smbspider program displays the contents of Windows shares.

\subsection{acccheck}
acccheck can verify the credentials of network folders.

\subsection{SMBMap}
SMBMap allows users to enumerate samba share drives across an entire domain and
even content download/upload.

