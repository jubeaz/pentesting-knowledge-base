\section{Recon}

\subsection{Hosts}
\url{https://learn.microsoft.com/en-us/mem/configmgr/core/plan-design/hierarchy/ports}

\begin{itemize}
    \item Scan for open TCP Port : 8530, 8531, 10123 (Site Server, Management Point)
    \item Scan for open TCP Port : 49152-49159 (Distribution Point)
    \item Scan for open UDP Port : 4011 (Operating System Deployment OSD)
\end{itemize}

\begin{verbatim}
# search sccm
nmap -p 80,443,445,1433,10123,8530,8531 -sV <target>
# search pxe
nmap -p 67,68,69,4011,547 -sU <target> 
\end{verbatim}

\subsection{MECM environment}

\subsubsection{ldap}

\begin{verbatim}
# AD search
([ADSISearcher]("objectClass=mSSMSManagementPoint")).FindAll() | % {$_.Properties}

# ldeep
ldeep ldap -t simple -u lowpriv -p Jubeaz12345+-  -d haas.local \
    -s ldap://dc03.haas.local sccm
ldeep ldap -t simple -u lowpriv -p Jubeaz12345+-  -d haas.local \
    -s ldap://dc03.haas.local \
    search "(objectclass=mssmsmanagementpoint)" dnshostname,msSMSSiteCode

# sccmhunter
python3 sccmhunter.py find -debug -u lowpriv -p Jubeaz12345+- -d haas.local -dc-ip dc.haas.local

# ldap query
search "(objectclass=mssmsmanagementpoint)" dnshostname,msSMSSiteCode
\end{verbatim}

\subsubsection{smb}

\begin{verbatim}
python3 sccmhunter.py smb -debug -u lowpriv -p Jubeaz12345+- -d haas.local -dc-ip dc.haas.local -save
python3 sccmhunter.py show -all
nxc smb 172.16.0.10 -u lowpriv -p Jubeaz12345+- -d haas.local --shares
\end{verbatim}

\subsubsection{windows host}
\begin{verbatim}

# on a SCCM client
 Get-WmiObject -Class SMS_Authority -Namespace root\CCM
 Get-WmiObject -Class SMS_Authority -Namespace root\CCM:CCM_Client=@

 # SharpSCCM
 SharpSCCM.exe local site-info
\end{verbatim}

\subsection{PXE boot media}
\begin{verbatim}
rpcdump.py <pxe_ip> |grep Protocol | grep  MS-WDSC
\end{verbatim}


attention il tappe sur 68 et 4011 alors que j'ai 
\begin{verbatim}
PORT     STATE         SERVICE
67/udp   open|filtered dhcps
68/udp   closed        dhcpc
69/udp   open          tftp
547/udp  closed        dhcpv6-server
4011/udp open|filtered altserviceboot
\end{verbatim}

\begin{verbatim}
sudo python3 pxethiefy.py explore -i eth0
sudo python3 pxethiefy.py explore -i eth0 -a 192.0.2.50  


 py.exe pxethief.py 2 172.16.0.10
\end{verbatim}






