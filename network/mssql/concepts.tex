\section{Concepts}

\subsection{Security principals, roles, \ldots}

\subsubsection{Security principals}

\href{https://learn.microsoft.com/en-us/sql/relational-databases/security/securables?view=sql-server-ver16}{Securables}  are the resources to which the SQL Server Database Engine authorization system regulates access. For example, a table is a securable. Some securables can be contained within others, creating nested hierarchies called "scopes" that can themselves be secured. The securable scopes are server, database, and schema.

The entity that receives permission to a securable is called a \href{https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/principals-database-engine?view=sql-server-ver16}{Principal}. there are two mains types of principals: 
\begin{itemize}
    \item \href{https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/create-a-database-user?view=sql-server-ver16}{users}: database-level
    \item \href{https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/create-a-login?view=sql-server-ver16}{logins}: server level. A login can be based on:
        \begin{itemize}
            \item a windows principal
            \item or not
        \end{itemize}
\end{itemize}


One login can be mapped to multiple users across multiple databases, with a maximum of one user per database.

Access to securables is controlled by granting (\href{https://learn.microsoft.com/en-us/sql/t-sql/statements/grant-transact-sql?view=sql-server-ver16}{GRANT}, \href{https://learn.microsoft.com/en-us/sql/t-sql/statements/revoke-transact-sql?view=sql-server-ver16}{REVOKE}) or denying (\href{https://learn.microsoft.com/en-us/sql/t-sql/statements/deny-transact-sql?view=sql-server-ver16}{DENY}) permissions, or by adding logins and users to roles (\href{https://learn.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-addrolemember-transact-sql?view=sql-server-ver16}{sp\_addrolemember}, \href{https://learn.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-droprolemember-transact-sql?view=sql-server-ver16}{sp\_droprolemember}) which have access.

\href{https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/credentials-database-engine?view=sql-server-ver16}{Credentials} are records that contains the authentication information (credentials) required to connect to a resource outside SQL Server.


\subsubsection{Roles}

Roles which can be fixed or user defined are groups of \href{https://learn.microsoft.com/en-us/sql/relational-databases/security/permissions-database-engine?view=sql-server-ver16}{permissions}
\begin{itemize}
    \item \href{https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/server-level-roles?view=sql-server-ver16}{Server-level roles}
    \item \href{https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/database-level-roles?view=sql-server-ver16}{Database-level roles}
    \item \href{https://learn.microsoft.com/en-us/sql/relational-databases/security/authentication-access/application-roles?view=sql-server-ver16}{Application roles}
\end{itemize}

\subsubsection{Authentication mode}

\href{https://learn.microsoft.com/en-us/sql/relational-databases/security/choose-an-authentication-mode?view=sql-server-ver16}{Authentication mode} can be: 
\begin{itemize}
    \item SQL Server
    \item Windows
\end{itemize}

Note: The  \verb+sa+ login is disabled by default when Windows Authentication Mode is selected during installation.

\subsection{Database, schema,\ldots}

On every SQL Server instance there is a number of default system databases. Those are"

\begin{itemize}
    \item master - keeps the information for an instance of SQL Server.
    \item msdb - used by SQL Server Agent.
    \item model - template database copied for each new database.
    \item resource - read only database that keeps system objects that are visible in every database on the server in sys schema.
    \item tempdb - keeps temporary objects for SQL queries.
\end{itemize}

In SQL Server, a {\bf schema} is a logical collection of database objects such as tables, views, stored procedures, indexes, triggers, functions. It can be thought of as a container, created by a database user. The database user who creates a schema is the schema owner.  SQL Server provides  built-in schemas such as \verb+dbo+ (the default for a newly created database), \verb+guest+, \verb+sys+, etc.


request a table and expression \verb+<db_name>.<schema_name>.<table_name>+ (or view name)


The \href{https://learn.microsoft.com/en-us/sql/relational-databases/security/trustworthy-database-property?view=sql-server-ver16}{TRUSTWORTHY database} property is used to indicate whether the instance of SQL Server trusts the database and the contents within it. By default, this setting is OFF, but can be set to ON

\subsection{Linked server}

MSSQL has a configuration option called
\href{https://docs.microsoft.com/en-us/sql/relational-databases/linked-servers/create-linked-servers-sql-server-database-engine}{linked
servers}. Linked servers are typically configured to enable the database engine
to execute a Transact-SQL statement that includes tables in another instance of
SQL Server, or another database product such as Oracle.

If we manage to gain access to a SQL Server with a linked server configured, we
may be able to move laterally to that database server. Administrators can
configure a linked server using credentials from the remote server. If those
credentials have sysadmin privileges, we may be able to execute commands in the
remote SQL instance. 


\subsection{SQL Server Agent}
SQL Server Agent provides a powerful tool for automating tasks within SQL Server known as SQL Jobs.

SQL Server Agent uses SQL Server to store job information.  Jobs are automated tasks or processes scheduled to run at specific intervals or in response to certain events. Jobs contain one or more job steps. Each step contains its own task.


SQL Server Agent is a component of SQL Server that runs as a Windows service. It acts as a job scheduler, executing jobs based on predefined schedules or triggers. SQL Jobs are managed and executed by SQL Server Agent, which ensures their timely execution and provides logging and notification features for monitoring job status.


\subsection{OLE Automation Stored Procedure}

\href{https://learn.microsoft.com/en-us/cpp/mfc/automation?view=msvc-170}{OLE Automation} is an inter-process communication mechanism developed by Microsoft which essentially allows us to use other languages such as VBScript from a T-SQL query.