
\section{Introduction}

\href{https://www.mandiant.com/sites/default/files/2021-09/wp-windows-management-instrumentation.pdf}{WINDOWS MANAGEMENT INSTRUMENTATION (WMI) OFFENSE, DEFENSE, AND FORENSICS}


Windows Management Instrumentation (WMI) is Microsoft's implementation and also
an extension of the {\bf Common Information Model (CIM)}, core functionality of the
standardized {\bf Web-Based Enterprise Management (WBEM)} for the Windows platform.
WMI allows read and write access to almost all settings on Windows systems.
Understandably, this makes it the most critical interface in the Windows
environment for the administration and remote maintenance of Windows computers,
regardless of whether they are PCs or servers. 

The initialization of the WMI communication always takes place on {\bf TCP port
135,} and after the successful establishment of the connection, the
communication is moved to a random port.

WMI is not a single program but consists of several programs and
various databases, also known as repositories. It is made up of the following
components: 

\begin{tabularx}{\linewidth}{|l|X|}
   \hline 
Component Name &	Description\\
   \hline 
WMI service & 	The Windows Management Instrumentation process, which runs
automatically at boot and acts as an intermediary between WMI providers, the
WMI repository, and managing applications.\\
   \hline 
Managed objects &	Any logical or physical components that can be managed by
WMI.\\
   \hline 
WMI providers &	Objects that monitor events/data related to a specific
object.\\
   \hline 
Classes &	These are used by the WMI providers to pass data to the WMI
service.\\
   \hline 
Methods &	These are attached to classes and allow actions to be performed.
For example, methods can be used to start/stop processes on remote machines.\\
   \hline 
WMI repository &	A database that stores all static data related to WMI.\\
   \hline 
CMI Object Manager &	The system that requests data from WMI providers and
returns it to the application requesting it.\\
   \hline 
WMI API &	Enables applications to access the WMI infrastructure.\\
   \hline 
WMI Consumer &	Sends queries to objects via the CMI Object Manager.\\
   \hline 
\end{tabularx}

Some of the uses for WMI are:
\begin{itemize}
    \item  Status information for local/remote systems
    \item  Configuring security settings on remote machines/applications
    \item  Setting and changing user and group permissions
    \item  Setting/modifying system properties
    \item  Code execution
    \item  Scheduling processes
    \item  Setting up logging
\end{itemize}

These tasks can all be performed using a combination of PowerShell and the WMI
Command-Line Interface (WMIC):
\begin{itemize}
    \item \href{https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmic}{WMI
Command-Line Interface (WMIC)}


    \item \href{https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-wmiobject?view=powershell-5.1}{Get-WmiObject
module} for PowerShell.


    \item
        \href{https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/invoke-wmimethod?view=powershell-5.1}{Invoke-WmiMethod
        module}
\end{itemize}


\subsection{Quick notes}

get-help transaction
get-help transcription

\$PROFILE  
1- create you profile
2- apply profile
3 run PS in Unrestricted or Bypass

\begin{verbatim}
$Transcriptionlo = $env:computername+'--'+(Get-Date -UFormat '%Y%m%d')
    Start-Transcript -LiteralPath 'c:\transcript\$Transcript.log' - Append
\end{verbatim}

\begin{verbatim}
get-help wmi
get-help CMI

CMI kind of new version of WMI. Faster and more elegant

Get-WMIObject -Class XXX | get-member
Get-WMIObject -Class XXX -Filter XXX
Get-WMIObject -Query 'Select * from \ldots where\ldots
Get-WMIObject -List *

WMI (windows management instrumentation) => objects

Get-WMIObjet, Set-WMIObject, Remove-WMIObject

CMI (common information model) => classes
Get-CIMClass -ClassName
Get-CIMClass -ClassName XXX | Get-Member
\end{verbatim}
