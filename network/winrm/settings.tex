\section{Dangerous settings}

\begin{verbatim}
winrm get winrm/config
\end{verbatim}


\begin{verbatim}
Get-WSManCredSSP
\end{verbatim}

\subsection{credssp (Multi-Hop Support in WinRM)}
\href{https://learn.microsoft.com/en-us/windows/win32/winrm/multi-hop-support}{Multi-Hop Support in WinRM}
\subsubsection{Client config}
\begin{verbatim}
# Enable client
Enable-WSManCredSSP -Role "Client" -DelegateComputer "*.<domain_fqdn>"

$allowed = @('WSMAN/*.<domain_fqdn>', '*')
$key = 'hklm:\SOFTWARE\Policies\Microsoft\Windows\CredentialsDelegation'
if (!(Test-Path $key)) {
    md $key
}
New-ItemProperty -Path $key -Name AllowFreshCredentials -Value 1 -PropertyType Dword -Force

$key = Join-Path $key 'AllowFreshCredentials'
if (!(Test-Path $key)) {
    md $key
}
$i = 1
$allowed |% {
    # Script does not take into account existing entries in this key
    New-ItemProperty -Path $key -Name $i -Value $_ -PropertyType String -Force
    $i++
}
\end{verbatim}

\subsubsection{Server config}

\begin{verbatim}
# Enable server
Enable-WSManCredSSP -Role "Server"
\end{verbatim}


