\section{Dangerous settings}

\begin{verbatim}
winrm get winrm/config
\end{verbatim}


\begin{verbatim}
Get-WSManCredSSP
\end{verbatim}

\subsection{credssp (Multi-Hop Support in WinRM)}
\href{https://learn.microsoft.com/en-us/windows/win32/winrm/multi-hop-support}{Multi-Hop Support in WinRM}
\subsubsection{Client config}
\begin{verbatim}
# Enable client
Enable-WSManCredSSP -Role "Client" -DelegateComputer "*.<domain_fqdn>"

\end{verbatim}

\subsubsection{Server config}

\begin{verbatim}
# Enable server
Enable-WSManCredSSP -Role "Server"
\end{verbatim}

The Allow Delegating Fresh Credentials (\href{https://admx.help/?Category=Windows_10_2016&Policy=Microsoft.Policies.CredentialsSSP::AllowFreshCredentials}{AllowFreshCredentials}) policy setting must be enabled on the WinRM client, and a SPN with the WSMAN prefix must be added to the policy. wildcard are allowed (\verb+WSMAN/*.myDomain.com+)

\begin{verbatim}
Get-ItemProperty -Path Registry::Software\policies\Microsoft\Windows\CredentialsDelegation -name AllowFreshCredentials
\end{verbatim}



An HTTPS or HTTP listener must be configured on the server.
\begin{verbatim}
winrm quickconfig -transport:https
\end{verbatim}


