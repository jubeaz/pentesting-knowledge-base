\section{double hop}
\subsection{Nested Invoke-Command}

\begin{verbatim}
$cred = $New-Object `
    System.Management.Automation.PSCredential("domain_netbios>\<user>", `
        (ConvertTo-SecureString '<password>' -Asplaintext -force))

Invoke-Command -ComputerName <target_1> -Credential $cred -ScriptBlock {
        Invoke-Command -ComputerName <target_2> `
            -Credential $Using:cred `
            -ScriptBlock {<cmd|hostname>}
}
\end{verbatim}


\subsection{Register PSSession Configuration}

\begin{verbatim}
Register-PSSessionConfiguration -Name <config_name>  -RunAsCredential "domain_netbios>\<user>"; 
Restart-Service WinRM
\end{verbatim}

reentering the ps-session with configuration will grant us a TGT
\begin{verbatim}
Enter-PSSession -ComputerName <target_name> `
    -Credential "domain_netbios>\<user>" `
    -ConfigurationName <config_name>
\end{verbatim}

\subsection{PortProxy}

on \verb|<target_1>|:
\begin{verbatim}
netsh interface portproxy add v4tov4 listenport=<in_port> listenaddress=<target_1_ip> connectport=5985 connectaddress=<target_1_ip>
\end{verbatim}

ensure that \verb|<in_port>| is open

\begin{verbatim}
enter-pssession <target_1>  -port <in_port> -Credential $creds
\end{verbatim}


\subsection{CredSSP}

from \href{https://learn.microsoft.com/en-us/powershell/module/microsoft.wsman.management/enable-wsmancredssp?view=powershell-7.4&viewFallbackFrom=powershell-7}{Enable-WSManCredSSP}

CredSSP authentication delegates the user credentials from the local computer to a remote computer. This practice increases the security risk of the remote operation. If the remote computer is compromised, when credentials are passed to it, the credentials can be used to control the network session.

\begin{verbatim}
enter-pssession fenris -Authentication 'Credssp' -Credential $cred
\end{verbatim}
