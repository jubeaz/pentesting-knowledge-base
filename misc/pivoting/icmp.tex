
\section{ICMP tunneling with SOCKS}

ICMP tunneling encapsulates your traffic within ICMP packets containing echo
requests and responses. ICMP tunneling would only work when ping responses are
permitted within a firewalled network. When a host within a firewalled network
is allowed to ping an external server, it can encapsulate its traffic within
the ping echo request and send it to an external server. The external server
can validate this traffic and send an appropriate response, which is extremely
useful for data exfiltration and creating pivot tunnels to an external server.a

\href{https://github.com/utoni/ptunnel-ng}{ptunel-ng} is a tool that can be
used 


\subsection{On pivot}
\begin{verbatim}
sudo ./ptunnel-ng -r$P_IP -R22
\end{verbatim}



\subsection{On attacker}
\begin{verbatim}
 sudo ./ptunnel-ng -p$P_IP -l2222 -r$P_IP -R22
\end{verbatim}

\subsubsection{Tunneling an SSH connection through}

\begin{verbatim}
ssh -p2222 -l$P_LOGIN 127.0.0.1
\end{verbatim}

\subsubsection{Enabling Dynamic Port Forwarding over SSH}
\begin{verbatim}
ssh -D 9050 -p2222 -l$P_LOGIN 127.0.0.1
proxychains nmap -sV -sT 172.16.5.19 -p3389
\end{verbatim}